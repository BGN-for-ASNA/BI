# Beta-Binomial Regression
## General Principles
To model the relationship between a binary outcome variable representing success counts and one or more predictor variables, we can use Beta-Binomial Regression. This approach is suitable when the outcome variable follows a beta-binomial distribution, which accounts for overdispersion relative to the binomial distribution.

We model the relationship between the predictor variables (X1, X2, ..., Xn) and the probability of success (p) using the following equation:

## Formula
$$
logit(ğ‘)=ğ‘‹_1âˆ—ğ‘Š_1+ğ‘‹_2âˆ—ğ‘Š_2+...+ğ‘‹_ğ‘›âˆ—ğ‘Š_ğ‘›+ğ‘
$$

Where:

- $p$ is the probability of success.
- $X1, X2, ..., Xn$ are the predictor variables.
- $W1, W2, ..., Wn$ are the regression coefficients.
- $b$ is the intercept term.
- $\text{logit}(p)$ is the log-odds of success.



## Considerations
In Bayesian Beta-Binomial regression, we consider uncertainty in the model parameters and provide a full posterior distribution over them. We need to declare prior distributions for W1, W2, ..., Wn, and b.

<span style="font-size:1em; color : red">
<i>
Additional conciderations : 
</i>
</span>

- The relationship between the predictor variables and the log-odds of success is modeled linearly, allowing us to interpret the effect of each predictor on the log-odds of success.

## Example
Below is an example code snippet demonstrating Bayesian Beta-Binomial regression:

```python
from BI import bi.hard
d = pd.read_csv('/home/sosa/BI/data/UCBadmit.csv', sep = ';')
d["gid"] = (d["applicant.gender"] != "male").astype(int)
gid = jnp.array(d["gid"].astype('int32').values)
applications = jnp.array(d["applications"].astype('float32').values)
admit = jnp.array(d["admit"].astype('float32').values)

def model():
    phi = yield exponential(1, 1)
    #phi2 =  tfp.bijectors.Exp().forward(phi)
    alpha = yield normal(2,0.,1.5)
    theta = phi + 2
    pbar = nn.sigmoid(alpha[gid])
    concentration1 = pbar*theta
    concentration0 = (1 - pbar) * theta
    y = yield Independent(BetaBinomial(applications, concentration1 = concentration1, concentration0 = concentration0), reinterpreted_batch_ndims=1)

posterior, sample_stats = NUTSdual(model, obs = admit)
```

## Mathematical Details
We can express the Bayesian Beta-Binomial regression model using probability distributions as follows:

$$
ğ‘(ğ‘Œâˆ£ğ‘‹,ğ‘Š,ğ‘)=BetaBinomial(ğ‘›,ğ›¼=ğ‘â‹…ğ‘›,ğ›½=(1âˆ’ğ‘)â‹…ğ‘›)
$$

$$
ğ‘(ğ‘Šğ‘–)=Normal(0,ğ›¼2)
$$
$$
ğ‘(ğ‘)=Normal(0,ğ›½2)
$$

Where:

- $p(Y | X, W, b)$ is the likelihood function.
- $p(Wi)$ and $p(b)$ are the prior distributions for the regression coefficients and intercept.
- $n is the total count of trials.
- $\alpha = p \cdot n$ and $\beta = (1 - p) \cdot n$ are the concentration parameters of the Beta distribution, with $p = \text{sigmoid}(X * W + b)$ being the success probability.
