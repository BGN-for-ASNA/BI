#  Regression for Categorical Variables
## General Principles
To study the relationship between a categorical independent variable and a continuous dependent variable, we use Categorical Regression through _stratification_. _Stratification_ concist in modeling how the different categories of the independent variable affect the target continuous variable, by simply performing a regression for each categories and asing a regression coefficient for each categories. To realize the  _stratification_, categorical variables are often encoded using one-hot encoding or converting categories to indeces.

## Formula
We model the relationship between the categorical input feature (X) and the target variable (Y) using the following equation:

$$ğ‘Œ=\alpha + \beta_i X + ğœ–$$

Where:

- $Y$ is the target variable.
- $X$ is the encoded categorical input variable .
- $\beta_i$ is the regression coefficient that vary according to the categories.
- $\alpha$ is the intercept term.
- $\epsilon$ is the error term assumed to be normally distributed.
  
In this context, $X$ is a vector representing the categories as binary values (one-hot encoding or index), $W_i$ is the vector of coefficients corresponding to each category, $b$ is the intercept term, and $\epsilon$ is the error term representing the model's noise.

We can interpret $W$ as the effect of each category on $Y$ relative to the baseline (usually one of the categories or the intercept). $b$ is the baseline level of $Y$ when $X$ is at its reference category.

## Considerations
Like for regression on continuous variable(s), we use a Normal distribution for W and b. Assuming the data is standardized, we use a distribution with a mean of 0 and a standard deviation of 1. We often use an exponential distribution for $\epsilon$ to ensure positive values, which aligns with the requirement that ğœ (the standard deviation) must be positive.

<span style="font-size:1em; color : red">
<i>
Additional conciderations : 
</i>
</span>

- As we generate regression coefficients for each category, we need to specify a prior with a shape equal to the number of categories (see comments in the code).
- From posterior predictions, we compute the distribution of the differences between categories, known as the contrast distribution. Never compare the confidence intervals or p-values directly.

## Example
Below is an example code snippet demonstrating Bayesian regression with an independent categorical variable:

```python
from BI import bi.hard
d = pd.read_csv('/home/sosa/BI/data/milk.csv', sep=';')
d["K"] = d["kcal.per.g"].pipe(lambda x: (x - x.mean()) / x.std())
d = index(d, cols = "clade")
index_clade = jnp.array(d.index_clade.values, dtype=jnp.int32)
def model():
    s = yield exponential(1, 1)
    a = yield normal(4, 0, 0.5)  # prior with a shape equal to the number of categories
    m = a[index_clade] # Assign Prior to the Corresponding Categories
    y = yield tfd.Independent(tfd.Normal(m, s), reinterpreted_batch_ndims=1)
    
posterior, sample_stats = NUTSdual(model, obs = jnp.array(d.K.values))
```

## Mathematical Details
We can express the Bayesian regression model with a categorical independent variable using probability distributions as follows:

$$
ğ‘(ğ‘Œâˆ£ğ‘‹,ğ‘Š,ğ‘)=Normal(\sum_i^n ğ‘‹_ğ‘–âˆ—ğ‘Š_ğ‘–+ğ‘,ğœÂ²) \\
ğ‘(ğ‘Šğ‘–)=Normal(0,ğ›¼Â²)\\
ğ‘(ğ‘)=Normal(0,ğ›½Â²)\\
ğ‘(ğœ)=Exponential(ğœ†)
$$

Where:

- $p(Y | X, W, b)$ is the likelihood function.
- $p(Wi)$ and $p(b)$ are the prior distributions for the regression coefficients and  intercept.
- $p(\sigma)$ is the prior distribution for the standard deviation, ensuring it is  positive.
- $\sigma^2$, $\alpha^2$, and $\beta^2$ are hyperparameters controlling the variance of the likelihood and priors.
- $\lambda$ is the rate parameter for the exponential distribution of $\sigma$.

## Notes

- We can apply multiple variables similarly as [chapter 2: Multiple continuous Variables](2.&#32;Multiple&#32;continuous&#32;Variables.md).
- We can apply interaction terms  similarly as [chapter 3: Interaction between continuous variables](3.&#32;Interaction&#32;between&#32;continuous&#32;variables.md).