## 11. Zero inflated 
## General Principles
Zero-Inflated Regression models are used when the outcome variable is a count variable with an excess of zero counts. These models combine a count model (e.g., Poisson or Negative Binomial) with a separate model for predicting the probability of excess zeros.

## Formula
We model the relationship between the predictor variables (_X1, X2, ..., Xn_) and the count outcome variable (_Y_) using two components:
1. A logistic regression model to predict the probability of an excess zero.
2. A count model (e.g., Poisson or Negative Binomial) to predict the count outcome.

The overall model can be represented as follows:

$$
\begin{aligned}
& \text{logit}(\pi) = X_1 * W_{1\pi} + X_2 * W_{2\pi} + ... + X_n * W_{n\pi} + b_\pi+ \epsilon_{\pi} \\
& \text{log}(\lambda) = X_1 * W_{1\lambda} + X_2 * W_{2\lambda} + ... + X_n * W_{n\lambda} + b_\lambda + \epsilon_{\lambda}\\
& Y \sim \begin{cases} 
0 & \text{with probability } \pi \\
\text{CountModel}(\lambda) & \text{with probability } (1 - \pi) 
\end{cases}
\end{aligned}
$$

Where:
- _\pi_ is the probability of an excess zero.
- _\lambda_ is the mean rate parameter of the count model.
- _X1, X2, ..., Xn_ are the predictor variables.
- _W_{1\pi}, W_{2\pi}, ..., W_{n\pi}_ are the regression coefficients for the logistic model.
- _W_{1\lambda}, W_{2\lambda}, ..., W_{n\lambda}_ are the regression coefficients for the count model.
- _b_\pi_ and _b_\lambda_ are the intercept terms for the logistic and count models, respectively.
- $\epsilon_{\pi}$ and $\epsilon_{\lambda}$ a the error term, typically assumed to be normally distributed with mean 0 and variance $\sigma^2$.

## Considerations
In Bayesian Zero-Inflated regression, we consider uncertainty in the model parameters and provide a full posterior distribution over them. We need to declare prior distributions for _W_{1\pi}, W_{2\pi}, ..., W_{n\pi}_, _W_{1\lambda}, W_{2\lambda}, ..., W_{n\lambda}_, _b_\pi_, and _b_\lambda_.

<span style="font-size:1em; color : red">
<i>
Additional conciderations : 
</i>
</span>


## Example

Below is an example code snippet demonstrating Bayesian Zero-Inflated Poisson regression using TensorFlow Probability:

```python
from BI import bi.hard
# Data simulation --------------------
# Define parameters
prob_drink = 0.2  # 20% of days
rate_work = 1     # average 1 manuscript per day

# sample one year of production
N = 365

np.random.seed(365)
drink = np.random.binomial(1, prob_drink, N)
y = (1 - drink) * np.random.poisson(rate_work, N)
d = pd.DataFrame(y)

# Model --------------------
def model():
    al = yield normal(1, 1, 0.5)
    ap = yield normal(1, -1.5 , 1)
    y = yield Independent(ZeroInflatedNegativeBinomial(total_count = 365, inflated_loc_logits = al, logits = jnp.log(ap)), reinterpreted_batch_ndims=1)

posterior, sample_stats = NUTSdual(model, obs = jnp.array(d.iloc[:,0].values))

```

## Mathematical Details
We can express the Bayesian Zero-Inflated Poisson regression model using probability distributions as follows:

$$
p(Y | X, W_\pi, b_\pi, W_\lambda, b_\lambda) = \pi \cdot \delta_0(Y) + (1 - \pi) \cdot \text{Poisson}(\lambda) \\
\pi = \text{sigmoid}(X * W_\pi + b_\pi) \\
\lambda = \exp(X * W_\lambda + b_\lambda) \\
p(W_{\pi_i}) = \text{Normal}(0, \alpha^2) \\
p(W_{\lambda_i}) = \text{Normal}(0, \alpha^2) \\
p(b_\pi) = \text{Normal}(0, \beta^2) \\
p(b_\lambda) = \text{Normal}(0, \beta^2)$$

Where:
- $p(Y | X, W_\pi, b_\pi, W_\lambda, b_\lambda)$ is the likelihood function for the zero-inflated model.
- $p(W_{\pi_i})$, $p(W_{\lambda_i})$, $p(b_\pi)$, and $p(b_\lambda)$ are the prior distributions for the regression coefficients and intercept terms.
- $\delta_0(Y)$ represents a Dirac delta function at zero, indicating the probability of an excess zero.
- $\text{Poisson}(\lambda)$ is the Poisson distribution with rate parameter _\lambda_.

