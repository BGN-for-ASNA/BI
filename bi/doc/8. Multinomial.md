# Multinomial Regression

## General Principles
To model the relationship between a categorical outcome variable with more than two categories and one or more predictor variables, we can use Multinomial Regression. The relationship between the predictor variables and the log-odds of each category is modeled linearly, allowing us to interpret the effect of each predictor on the log-odds of each category.

## Considerations
In Bayesian Multinomial regression, we consider uncertainty in the model parameters and provide a full posterior distribution over them. We need to declare prior distributions for $W$ and $b_k$ for each category k.

<span style="font-size:1em; color : red">
<i>
Additional conciderations : 
</i>
</span>

- In a multinomial model, you need K − 1 linear models for K types of events. Estimates need to be converted to a vector of probabilities using the softmax function 

## Example

```python
# Data simulation--------------------------------------------------------------------------
## simulate career choices among 500 individuals
N = 500  # number of individuals
income = np.array([1, 2, 5])  # expected income of each career
score = 0.5 * income  # scores for each career, based on income

## next line converts scores to probabilities
p = jnp.array(tf.nn.softmax(score))

## now simulate choice
## outcome career holds event type values, not counts
career = tfd.Categorical(probs=p).sample(seed = init_key, sample_shape = N)
result = [income[index] for index in career]
data = {'career': career, 'income': result}
d = pd.DataFrame(data)
career = jnp.array(d.career.values)
career_income = jnp.array(d.income.values)
income = jnp.array(income)

# Model-------------------------------------------------------------------------------------

def model():
    a = yield normal(2, 0, 1)
    b = yield halfnormal(1,0.5)
    ##  K − 1 linear models
    s_1 = a[0] + b * income[0]
    s_2 = a[1] + b * income[1]
    s_3 = [0]

    # converted to a vector of probabilities 
    p = nn.softmax(jnp.stack([s_1[0], s_2[0], s_3[0]])) 
    p = p[career] 

    y = yield Independent(Categorical(probs =  p))

posterior, sample_stats = NUTS(model, obs = career)
```

## Mathematical Details
We can express the Bayesian Multinomial model as follows:

If  $K∈N ,  N∈N , and  θ∈K$-simplex , then for  $y∈NK$  such that  $∑Kk=1yk=N$:

$$
Multinomial(y|θ)=(Ny1,…,yK)K∏k=1 θykk
$$

Where the multinomial coefficient is defined by:

$$
(\frac{N}{y_1,…,y_k})=\frac{N!}{∏^K_{k=1}yk!}
$$
