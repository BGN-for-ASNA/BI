# Multinomial Regression

## General Principles
To model the relationship between a categorical outcome variable with more than two categories and one or more predictor variables, we can use Multinomial Regression. The relationship between the predictor variables and the log-odds of each category is modeled linearly, allowing us to interpret the effect of each predictor on the log-odds of each category.

## Formula
We model the relationship between the predictor variables (X1, X2, ..., Xn) and the categorical outcome variable (Y) using the following equation:

$$
logit(ğ‘_ğ‘˜)=ğ‘‹_1âˆ—ğ‘Š_{1ğ‘˜}+ğ‘‹_2âˆ—ğ‘Š_{2ğ‘˜}+...+ğ‘‹_ğ‘›âˆ—ğ‘Š_{ğ‘›ğ‘˜}+ğ‘_k
$$
Where:

$p_k$ is the probability of category $k$.
$X1, X2, ..., Xn$ are the predictor variables.
$W1k, W2k, ..., Wnk$ are the regression coefficients for category $k$.
$b_k$ is the intercept term for category $k$.
$logit(ğ‘_ğ‘˜)$ is the log-odds of category $k$.

## Considerations
In Bayesian Multinomial regression, we consider uncertainty in the model parameters and provide a full posterior distribution over them. We need to declare prior distributions for $W$ and $b_k$ for each category k.

<span style="font-size:1em; color : red">
<i>
Additional conciderations : 
</i>
</span>

- In a multinomial model, you need K âˆ’ 1 linear models for K types of events. Estimates need to be converted to a vector of probabilities using the softmax function.
- The relationship between the predictor variables and the log-odds of each category is modeled linearly, allowing us to interpret the effect of each predictor on the log-odds of each category. 

## Example

```python
from BI import bi.hard
# Data simulation--------------------------------------------------------------------------
## simulate career choices among 500 individuals
N = 500  # number of individuals
income = np.array([1, 2, 5])  # expected income of each career
score = 0.5 * income  # scores for each career, based on income

## next line converts scores to probabilities
p = jnp.array(tf.nn.softmax(score))

## now simulate choice
## outcome career holds event type values, not counts
career = tfd.Categorical(probs=p).sample(seed = init_key, sample_shape = N)
result = [income[index] for index in career]
data = {'career': career, 'income': result}
d = pd.DataFrame(data)
career = jnp.array(d.career.values)
career_income = jnp.array(d.income.values)
income = jnp.array(income)

# Model-------------------------------------------------------------------------------------

def model():
    a = yield normal(2, 0, 1)
    b = yield halfnormal(1,0.5)
    ##  K âˆ’ 1 linear models
    s_1 = a[0] + b * income[0]
    s_2 = a[1] + b * income[1]
    s_3 = [0]

    # converted to a vector of probabilities 
    p = nn.softmax(jnp.stack([s_1[0], s_2[0], s_3[0]])) 
    p = p[career] 

    y = yield Independent(Categorical(probs =  p))

posterior, sample_stats = NUTS(model, obs = career)
```

## Mathematical Details
We can express the Bayesian Multinomial model as follows:

If  $KâˆˆN ,  NâˆˆN , and  Î¸âˆˆK$-simplex , then for  $yâˆˆNK$  such that  $âˆ‘Kk=1yk=N$:

$$
Multinomial(y|Î¸)=(Ny1,â€¦,yK)Kâˆk=1 Î¸ykk
$$

Where the multinomial coefficient is defined by:

$$
(\frac{N}{y_1,â€¦,y_k})=\frac{N!}{âˆ^K_{k=1}yk!}
$$
