{
  "hash": "eb7eed6898abb98e560cdb99971354b5",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Dirichlet Process Mixture Models\"\ndescription: \"A non-parametric Bayesian clustering method that automatically determines the number of clusters.\"\ncategories: [Clustering, Unsupervised Learning, Non-parametric]\nimage: \"Figures/20.png\"\norder: 24\n---\n\n## General Principles\n\nTo discover group structures or clusters in data without pre-specifying the number of groups, we can use a **Dirichlet Process Mixture Model (DPMM)**. This is a [non-parametric ðŸ›ˆ]{style=\"color:#0D6EFD\"} clustering method. Essentially, the model assumes the data is generated from a collection of different Gaussian distributions, and it simultaneously tries to figure out:\n\n1.  **How many clusters (`K`) exist**: Unlike algorithms like K-Means, the DPMM infers the most probable number of clusters directly from the data.\n2.  **The properties of each cluster**: For each inferred cluster, it estimates its center (mean $\\mu$) and its shape/spread (covariance $\\sigma$).\n3.  **The assignment of each data point**: It determines the probability of each data point belonging to each cluster.\n\n## Considerations\n\n::: callout-caution\n-   A DPMM is a Bayesian model ðŸ›ˆ that considers uncertainty in all its parameters. The core idea is to use the Dirichlet Process prior that allows for a potentially infinite number of clusters. In practice, we use a finite approximation called the [Stick-Breaking Process ðŸ›ˆ]{style=\"color:#0D6EFD\"}.\n\n-   The key parameters and their priors are:\n\n    - **Concentration** $\\alpha$: This single parameter controls the tendency to create new clusters. A low `Î±` favors fewer, larger clusters, while a high `Î±` allows for many smaller clusters. We typically place a `Gamma` prior on $\\alpha$ to learn its value from the data.\n- \n    - **Cluster Weights `w`**: Generated via the Stick-Breaking process from $\\alpha$. These are the probabilities of drawing a data point from any given cluster.\n  \n    - **Cluster Parameters (**$\\mu$, $\\sigma$): Each potential cluster has a mean $\\mu$ and a covariance matrix $\\sigma$. If the data have multiple dimensions, we use a multivariate normal distribution (see chapter, [14](14.%20Varying%20slopes.qmd)). Howver, if the data is one-dimensional, we use a univariate normal distribution.\n\n-   The model is often implemented in its [marginalized form ðŸ›ˆ]{style=\"color:#0D6EFD\"}. Instead of explicitly assigning each data point to a cluster, we integrate out this choice. This creates a smoother probability surface for the inference algorithm to explore, leading to much more efficient computation.\n:::\n\n## Example\n\nBelow is an example of a DPMM implemented in BI. The goal is to cluster a synthetic dataset into its underlying groups. The code first generates data with 4 distinct centers and then applies the DPMM to recover these clusters.\n\n::: {.panel-tabset group=\"language\"}\n## Python\n\n::: {#9d4060d3 .cell execution_count=1}\n``` {.python .cell-code}\nfrom BI import bi, jnp\nfrom BI.Models.DPMM import mix_weights\nfrom sklearn.datasets import make_blobs\nimport numpyro\n\nm = bi()\n\n# Generate synthetic data\ndata, true_labels = make_blobs(\n    n_samples=500, centers=8, cluster_std=0.8,\n    center_box=(-10,10), random_state=101\n)\n\n#  The model\ndef dpmm(data, T=10):\n    N, D = data.shape  # Number of features\n    data_mean = jnp.mean(data, axis=0)\n    data_std = jnp.std(data, axis=0)*2\n\n    # 1) stick-breaking weights\n    alpha = m.dist.gamma(1.0, 10.0,name='alpha')\n\n    with m.dist.plate(\"beta_plate\", T - 1):\n        beta = m.dist.beta(1, alpha)\n\n    w = numpyro.deterministic(\"w\",mix_weights(beta))\n\n    # 2) component parameters\n    with m.dist.plate(\"components\", T):\n        mu = m.dist.multivariate_normal(loc=data_mean, covariance_matrix=data_std*jnp.eye(D),name='mu')# shape (T, D)        \n        sigma = m.dist.log_normal(0.0, 1.0,shape=(D,),event=1,name='sigma')# shape (T, D)\n        Lcorr = m.dist.lkj_cholesky(dimension=D, concentration=1.0,name='Lcorr')# shape (T, D, D)\n\n        scale_tril = sigma[..., None] * Lcorr  # shape (T, D, D)\n\n    # 3) Latent cluster assignments for each data point\n    with m.dist.plate(\"data\", N):\n        # Sample the assignment for each data point\n        z = m.dist.categorical(w, name = 'z') # shape (N,)  \n\n        # Sample the data point from the assigned component\n        m.dist.multivariate_normal(loc=mu[z], scale_tril=scale_tril[z],\n            obs=data, name = 'Y'\n        )  \n\nm.data_on_model = dict(data=data)\nm.fit(dpmm)  # Optimize model parameters through MCMC sampling\nm.plot(X=data,sampler=m.sampler) # Prebuild plot function for GMM\n```\n\n::: {.cell-output .cell-output-stdout}\n```\njax.local_device_count 16\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n/home/sosa/work/BI/BI/Main/main.py:236: FutureWarning:\n\nSome algorithms will automatically enumerate the discrete latent site z of your model. In the future, enumerated sites need to be marked with `infer={'enumerate': 'parallel'}`.\n\n\r  0%|          | 0/1000 [00:00<?, ?it/s]\rwarmup:   0%|          | 1/1000 [00:03<58:35,  3.52s/it, 1 steps of size 2.34e+00. acc. prob=0.00]\rwarmup:   2%|â–         | 16/1000 [00:03<02:44,  5.98it/s, 255 steps of size 2.91e-02. acc. prob=0.68]\rwarmup:   2%|â–         | 22/1000 [00:04<02:30,  6.49it/s, 1023 steps of size 2.23e-02. acc. prob=0.71]\rwarmup:   3%|â–Ž         | 26/1000 [00:05<02:34,  6.30it/s, 511 steps of size 6.59e-02. acc. prob=0.73] \rwarmup:   3%|â–Ž         | 29/1000 [00:05<02:10,  7.44it/s, 255 steps of size 5.93e-02. acc. prob=0.74]\rwarmup:   3%|â–Ž         | 32/1000 [00:05<01:48,  8.93it/s, 127 steps of size 1.02e-01. acc. prob=0.75]\rwarmup:   4%|â–Ž         | 35/1000 [00:05<02:04,  7.73it/s, 1023 steps of size 8.41e-03. acc. prob=0.72]\rwarmup:   4%|â–Ž         | 37/1000 [00:06<02:36,  6.15it/s, 1023 steps of size 2.30e-02. acc. prob=0.74]\rwarmup:   4%|â–         | 39/1000 [00:06<02:23,  6.72it/s, 383 steps of size 4.45e-02. acc. prob=0.75] \rwarmup:   4%|â–         | 42/1000 [00:07<02:06,  7.60it/s, 767 steps of size 2.43e-02. acc. prob=0.74]\rwarmup:   4%|â–         | 44/1000 [00:07<01:54,  8.36it/s, 127 steps of size 5.17e-02. acc. prob=0.75]\rwarmup:   5%|â–         | 47/1000 [00:07<01:32, 10.29it/s, 255 steps of size 4.14e-02. acc. prob=0.75]\rwarmup:   5%|â–Œ         | 51/1000 [00:07<01:16, 12.41it/s, 511 steps of size 2.85e-02. acc. prob=0.75]\rwarmup:   5%|â–Œ         | 53/1000 [00:07<01:14, 12.68it/s, 127 steps of size 3.98e-02. acc. prob=0.75]\rwarmup:   6%|â–Œ         | 56/1000 [00:07<01:03, 14.86it/s, 191 steps of size 5.82e-02. acc. prob=0.76]\rwarmup:   6%|â–Œ         | 59/1000 [00:07<00:59, 15.90it/s, 255 steps of size 8.59e-03. acc. prob=0.75]\rwarmup:   6%|â–Œ         | 61/1000 [00:10<05:43,  2.73it/s, 191 steps of size 2.18e-02. acc. prob=0.75]\rwarmup:   6%|â–‹         | 63/1000 [00:10<04:38,  3.36it/s, 127 steps of size 3.99e-02. acc. prob=0.76]\rwarmup:   7%|â–‹         | 67/1000 [00:11<02:58,  5.24it/s, 255 steps of size 2.45e-02. acc. prob=0.76]\rwarmup:   7%|â–‹         | 70/1000 [00:11<02:13,  6.95it/s, 63 steps of size 7.36e-02. acc. prob=0.77] \rwarmup:   7%|â–‹         | 72/1000 [00:11<01:58,  7.86it/s, 383 steps of size 3.99e-02. acc. prob=0.76]\rwarmup:   8%|â–Š         | 76/1000 [00:11<01:22, 11.17it/s, 159 steps of size 2.67e-02. acc. prob=0.76]\rwarmup:   8%|â–Š         | 79/1000 [00:11<01:12, 12.77it/s, 127 steps of size 7.52e-02. acc. prob=0.77]\rwarmup:   8%|â–Š         | 82/1000 [00:11<01:06, 13.76it/s, 255 steps of size 4.28e-02. acc. prob=0.77]\rwarmup:   8%|â–Š         | 84/1000 [00:11<01:07, 13.64it/s, 383 steps of size 2.28e-02. acc. prob=0.76]\rwarmup:   9%|â–Š         | 87/1000 [00:12<00:57, 16.00it/s, 127 steps of size 3.25e-02. acc. prob=0.77]\rwarmup:   9%|â–‰         | 90/1000 [00:12<00:56, 16.02it/s, 255 steps of size 4.02e-02. acc. prob=0.77]\rwarmup:   9%|â–‰         | 93/1000 [00:12<00:49, 18.31it/s, 63 steps of size 4.57e-02. acc. prob=0.77] \rwarmup:  10%|â–‰         | 96/1000 [00:12<00:44, 20.26it/s, 127 steps of size 2.77e-02. acc. prob=0.77]\rwarmup:  10%|â–‰         | 99/1000 [00:12<00:43, 20.84it/s, 95 steps of size 4.75e-02. acc. prob=0.77] \rwarmup:  10%|â–ˆ         | 104/1000 [00:12<00:42, 21.13it/s, 511 steps of size 2.16e-02. acc. prob=0.76]\rwarmup:  11%|â–ˆ         | 107/1000 [00:13<00:58, 15.36it/s, 511 steps of size 1.13e-02. acc. prob=0.76]\rwarmup:  11%|â–ˆ         | 109/1000 [00:13<01:13, 12.12it/s, 511 steps of size 3.40e-02. acc. prob=0.77]\rwarmup:  11%|â–ˆ         | 111/1000 [00:13<01:12, 12.24it/s, 255 steps of size 2.79e-02. acc. prob=0.77]\rwarmup:  11%|â–ˆâ–        | 113/1000 [00:13<01:11, 12.36it/s, 255 steps of size 2.36e-02. acc. prob=0.77]\rwarmup:  12%|â–ˆâ–        | 115/1000 [00:13<01:10, 12.54it/s, 255 steps of size 2.55e-02. acc. prob=0.77]\rwarmup:  12%|â–ˆâ–        | 118/1000 [00:14<01:26, 10.14it/s, 1023 steps of size 1.16e-02. acc. prob=0.76]\rwarmup:  12%|â–ˆâ–        | 120/1000 [00:14<01:37,  8.99it/s, 511 steps of size 3.47e-02. acc. prob=0.77] \rwarmup:  12%|â–ˆâ–        | 122/1000 [00:14<01:27,  9.98it/s, 127 steps of size 4.46e-02. acc. prob=0.77]\rwarmup:  12%|â–ˆâ–        | 124/1000 [00:15<01:47,  8.14it/s, 1023 steps of size 1.74e-02. acc. prob=0.77]\rwarmup:  13%|â–ˆâ–Ž        | 126/1000 [00:15<01:36,  9.02it/s, 255 steps of size 3.73e-02. acc. prob=0.77] \rwarmup:  13%|â–ˆâ–Ž        | 128/1000 [00:15<01:27,  9.93it/s, 255 steps of size 2.66e-02. acc. prob=0.77]\rwarmup:  13%|â–ˆâ–Ž        | 130/1000 [00:15<01:28,  9.88it/s, 255 steps of size 1.58e-02. acc. prob=0.77]\rwarmup:  13%|â–ˆâ–Ž        | 132/1000 [00:15<01:27,  9.97it/s, 127 steps of size 3.55e-02. acc. prob=0.77]\rwarmup:  13%|â–ˆâ–Ž        | 134/1000 [00:16<01:16, 11.32it/s, 255 steps of size 5.49e-02. acc. prob=0.77]\rwarmup:  14%|â–ˆâ–Ž        | 136/1000 [00:16<01:07, 12.78it/s, 255 steps of size 1.95e-02. acc. prob=0.77]\rwarmup:  14%|â–ˆâ–        | 138/1000 [00:16<01:15, 11.39it/s, 255 steps of size 3.52e-02. acc. prob=0.77]\rwarmup:  14%|â–ˆâ–        | 140/1000 [00:16<01:09, 12.40it/s, 191 steps of size 5.78e-02. acc. prob=0.77]\rwarmup:  14%|â–ˆâ–        | 143/1000 [00:16<01:00, 14.12it/s, 255 steps of size 2.45e-02. acc. prob=0.77]\rwarmup:  15%|â–ˆâ–        | 147/1000 [00:16<00:49, 17.19it/s, 255 steps of size 3.31e-02. acc. prob=0.77]\rwarmup:  15%|â–ˆâ–Œ        | 151/1000 [00:17<00:49, 17.01it/s, 511 steps of size 1.15e-01. acc. prob=0.77]\rwarmup:  15%|â–ˆâ–Œ        | 154/1000 [00:17<00:52, 16.02it/s, 511 steps of size 1.61e-02. acc. prob=0.77]\rwarmup:  16%|â–ˆâ–Œ        | 156/1000 [00:17<00:53, 15.63it/s, 255 steps of size 1.11e-02. acc. prob=0.77]\rwarmup:  16%|â–ˆâ–Œ        | 158/1000 [00:17<01:01, 13.58it/s, 511 steps of size 1.82e-02. acc. prob=0.77]\rwarmup:  16%|â–ˆâ–Œ        | 160/1000 [00:17<00:58, 14.42it/s, 127 steps of size 2.87e-02. acc. prob=0.77]\rwarmup:  16%|â–ˆâ–‹        | 163/1000 [00:18<01:10, 11.85it/s, 1023 steps of size 8.41e-03. acc. prob=0.77]\rwarmup:  16%|â–ˆâ–‹        | 165/1000 [00:18<01:16, 10.88it/s, 255 steps of size 2.55e-02. acc. prob=0.77] \rwarmup:  17%|â–ˆâ–‹        | 167/1000 [00:18<01:12, 11.48it/s, 255 steps of size 5.28e-03. acc. prob=0.77]\rwarmup:  17%|â–ˆâ–‹        | 169/1000 [00:18<01:40,  8.27it/s, 511 steps of size 1.56e-02. acc. prob=0.77]\rwarmup:  17%|â–ˆâ–‹        | 171/1000 [00:19<01:35,  8.65it/s, 255 steps of size 1.18e-02. acc. prob=0.77]\rwarmup:  17%|â–ˆâ–‹        | 173/1000 [00:19<01:31,  9.05it/s, 255 steps of size 2.52e-02. acc. prob=0.77]\rwarmup:  18%|â–ˆâ–Š        | 175/1000 [00:19<01:17, 10.66it/s, 127 steps of size 3.37e-02. acc. prob=0.77]\rwarmup:  18%|â–ˆâ–Š        | 178/1000 [00:19<01:03, 12.90it/s, 255 steps of size 2.76e-02. acc. prob=0.77]\rwarmup:  18%|â–ˆâ–Š        | 181/1000 [00:19<01:12, 11.30it/s, 1023 steps of size 9.70e-03. acc. prob=0.77]\rwarmup:  18%|â–ˆâ–Š        | 183/1000 [00:20<01:16, 10.67it/s, 255 steps of size 2.87e-02. acc. prob=0.77] \rwarmup:  18%|â–ˆâ–Š        | 185/1000 [00:20<01:10, 11.51it/s, 95 steps of size 1.06e-02. acc. prob=0.77] \rwarmup:  19%|â–ˆâ–Š        | 187/1000 [00:20<01:15, 10.76it/s, 255 steps of size 2.53e-02. acc. prob=0.77]\rwarmup:  19%|â–ˆâ–‰        | 190/1000 [00:20<01:01, 13.13it/s, 255 steps of size 1.73e-02. acc. prob=0.77]\rwarmup:  19%|â–ˆâ–‰        | 192/1000 [00:21<01:34,  8.56it/s, 1023 steps of size 3.39e-02. acc. prob=0.77]\rwarmup:  20%|â–ˆâ–‰        | 195/1000 [00:21<01:18, 10.25it/s, 511 steps of size 1.08e-02. acc. prob=0.77] \rwarmup:  20%|â–ˆâ–‰        | 197/1000 [00:21<01:32,  8.65it/s, 255 steps of size 2.64e-02. acc. prob=0.77]\rwarmup:  20%|â–ˆâ–‰        | 199/1000 [00:21<01:23,  9.58it/s, 255 steps of size 6.73e-03. acc. prob=0.77]\rwarmup:  20%|â–ˆâ–ˆ        | 201/1000 [00:22<01:46,  7.54it/s, 511 steps of size 1.70e-02. acc. prob=0.77]\rwarmup:  20%|â–ˆâ–ˆ        | 203/1000 [00:22<01:28,  9.03it/s, 127 steps of size 3.89e-02. acc. prob=0.78]\rwarmup:  20%|â–ˆâ–ˆ        | 205/1000 [00:22<01:37,  8.12it/s, 1023 steps of size 1.00e-02. acc. prob=0.77]\rwarmup:  21%|â–ˆâ–ˆ        | 207/1000 [00:22<01:50,  7.19it/s, 767 steps of size 2.49e-02. acc. prob=0.77] \rwarmup:  21%|â–ˆâ–ˆ        | 210/1000 [00:23<01:22,  9.53it/s, 255 steps of size 2.96e-02. acc. prob=0.78]\rwarmup:  21%|â–ˆâ–ˆâ–       | 213/1000 [00:23<01:28,  8.86it/s, 1023 steps of size 1.55e-02. acc. prob=0.77]\rwarmup:  22%|â–ˆâ–ˆâ–       | 215/1000 [00:23<01:25,  9.16it/s, 255 steps of size 1.88e-02. acc. prob=0.78] \rwarmup:  22%|â–ˆâ–ˆâ–       | 217/1000 [00:23<01:24,  9.23it/s, 511 steps of size 2.12e-02. acc. prob=0.78]\rwarmup:  22%|â–ˆâ–ˆâ–       | 219/1000 [00:24<01:23,  9.36it/s, 511 steps of size 3.05e-02. acc. prob=0.78]\rwarmup:  22%|â–ˆâ–ˆâ–       | 221/1000 [00:24<01:11, 10.89it/s, 255 steps of size 2.10e-02. acc. prob=0.78]\rwarmup:  22%|â–ˆâ–ˆâ–       | 223/1000 [00:24<01:22,  9.42it/s, 255 steps of size 3.11e-02. acc. prob=0.78]\rwarmup:  22%|â–ˆâ–ˆâ–Ž       | 225/1000 [00:24<01:13, 10.49it/s, 383 steps of size 3.67e-02. acc. prob=0.78]\rwarmup:  23%|â–ˆâ–ˆâ–Ž       | 227/1000 [00:24<01:09, 11.10it/s, 63 steps of size 3.98e-02. acc. prob=0.78] \rwarmup:  23%|â–ˆâ–ˆâ–Ž       | 229/1000 [00:24<01:21,  9.44it/s, 1023 steps of size 1.79e-02. acc. prob=0.78]\rwarmup:  23%|â–ˆâ–ˆâ–Ž       | 231/1000 [00:25<01:17,  9.96it/s, 255 steps of size 3.15e-02. acc. prob=0.78] \rwarmup:  23%|â–ˆâ–ˆâ–Ž       | 233/1000 [00:25<01:06, 11.51it/s, 127 steps of size 1.55e-02. acc. prob=0.78]\rwarmup:  24%|â–ˆâ–ˆâ–Ž       | 235/1000 [00:25<01:02, 12.31it/s, 255 steps of size 2.80e-02. acc. prob=0.78]\rwarmup:  24%|â–ˆâ–ˆâ–Ž       | 237/1000 [00:25<00:55, 13.64it/s, 127 steps of size 2.92e-02. acc. prob=0.78]\rwarmup:  24%|â–ˆâ–ˆâ–       | 239/1000 [00:25<00:58, 13.07it/s, 511 steps of size 3.41e-02. acc. prob=0.78]\rwarmup:  24%|â–ˆâ–ˆâ–       | 241/1000 [00:25<01:00, 12.55it/s, 255 steps of size 1.81e-02. acc. prob=0.78]\rwarmup:  24%|â–ˆâ–ˆâ–       | 243/1000 [00:26<01:07, 11.20it/s, 511 steps of size 1.74e-02. acc. prob=0.78]\rwarmup:  24%|â–ˆâ–ˆâ–       | 245/1000 [00:26<01:04, 11.66it/s, 255 steps of size 2.72e-02. acc. prob=0.78]\rwarmup:  25%|â–ˆâ–ˆâ–       | 247/1000 [00:26<01:13, 10.19it/s, 255 steps of size 1.61e-02. acc. prob=0.78]\rwarmup:  25%|â–ˆâ–ˆâ–       | 249/1000 [00:26<01:03, 11.74it/s, 127 steps of size 2.80e-02. acc. prob=0.78]\rwarmup:  25%|â–ˆâ–ˆâ–Œ       | 251/1000 [00:26<00:57, 12.93it/s, 127 steps of size 3.64e-01. acc. prob=0.78]\rwarmup:  25%|â–ˆâ–ˆâ–Œ       | 254/1000 [00:27<01:03, 11.73it/s, 1023 steps of size 7.31e-03. acc. prob=0.77]\rwarmup:  26%|â–ˆâ–ˆâ–Œ       | 256/1000 [00:27<01:14,  9.96it/s, 511 steps of size 1.74e-02. acc. prob=0.78] \rwarmup:  26%|â–ˆâ–ˆâ–Œ       | 258/1000 [00:27<01:05, 11.37it/s, 127 steps of size 4.61e-02. acc. prob=0.78]\rwarmup:  26%|â–ˆâ–ˆâ–Œ       | 262/1000 [00:27<00:45, 16.33it/s, 63 steps of size 6.22e-02. acc. prob=0.78] \rwarmup:  26%|â–ˆâ–ˆâ–‹       | 265/1000 [00:27<00:57, 12.89it/s, 127 steps of size 4.08e-02. acc. prob=0.78]\rwarmup:  27%|â–ˆâ–ˆâ–‹       | 269/1000 [00:27<00:42, 17.23it/s, 31 steps of size 1.10e-01. acc. prob=0.78] \rwarmup:  27%|â–ˆâ–ˆâ–‹       | 273/1000 [00:28<00:33, 21.50it/s, 63 steps of size 1.04e-01. acc. prob=0.78]\rwarmup:  28%|â–ˆâ–ˆâ–Š       | 279/1000 [00:28<00:26, 27.67it/s, 255 steps of size 7.98e-03. acc. prob=0.78]\rwarmup:  28%|â–ˆâ–ˆâ–Š       | 283/1000 [00:28<00:33, 21.40it/s, 127 steps of size 7.09e-02. acc. prob=0.78]\rwarmup:  29%|â–ˆâ–ˆâ–‰       | 288/1000 [00:28<00:27, 25.74it/s, 63 steps of size 1.98e-02. acc. prob=0.78] \rwarmup:  29%|â–ˆâ–ˆâ–‰       | 292/1000 [00:28<00:27, 26.12it/s, 63 steps of size 1.21e-01. acc. prob=0.78]\rwarmup:  30%|â–ˆâ–ˆâ–‰       | 298/1000 [00:28<00:21, 32.04it/s, 63 steps of size 3.83e-02. acc. prob=0.78]\rwarmup:  30%|â–ˆâ–ˆâ–ˆ       | 302/1000 [00:28<00:21, 33.12it/s, 63 steps of size 6.67e-02. acc. prob=0.78]\rwarmup:  31%|â–ˆâ–ˆâ–ˆ       | 307/1000 [00:29<00:20, 34.30it/s, 127 steps of size 5.59e-02. acc. prob=0.78]\rwarmup:  31%|â–ˆâ–ˆâ–ˆ       | 311/1000 [00:29<00:19, 34.88it/s, 127 steps of size 5.59e-02. acc. prob=0.78]\rwarmup:  32%|â–ˆâ–ˆâ–ˆâ–      | 319/1000 [00:29<00:15, 44.67it/s, 63 steps of size 1.05e-01. acc. prob=0.78] \rwarmup:  32%|â–ˆâ–ˆâ–ˆâ–Ž      | 325/1000 [00:29<00:14, 46.62it/s, 63 steps of size 1.02e-01. acc. prob=0.78]\rwarmup:  33%|â–ˆâ–ˆâ–ˆâ–Ž      | 331/1000 [00:29<00:13, 49.77it/s, 63 steps of size 4.47e-02. acc. prob=0.78]\rwarmup:  34%|â–ˆâ–ˆâ–ˆâ–Ž      | 337/1000 [00:29<00:13, 50.91it/s, 63 steps of size 5.16e-02. acc. prob=0.78]\rwarmup:  34%|â–ˆâ–ˆâ–ˆâ–      | 344/1000 [00:29<00:12, 54.66it/s, 63 steps of size 1.02e-01. acc. prob=0.78]\rwarmup:  35%|â–ˆâ–ˆâ–ˆâ–Œ      | 350/1000 [00:29<00:12, 51.63it/s, 63 steps of size 4.53e-02. acc. prob=0.78]\rwarmup:  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 356/1000 [00:30<00:12, 53.13it/s, 31 steps of size 1.16e-01. acc. prob=0.78]\rwarmup:  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 362/1000 [00:30<00:12, 49.80it/s, 63 steps of size 7.81e-02. acc. prob=0.78]\rwarmup:  37%|â–ˆâ–ˆâ–ˆâ–‹      | 368/1000 [00:30<00:13, 47.11it/s, 127 steps of size 3.66e-02. acc. prob=0.78]\rwarmup:  37%|â–ˆâ–ˆâ–ˆâ–‹      | 373/1000 [00:30<00:14, 42.19it/s, 63 steps of size 6.31e-02. acc. prob=0.78] \rwarmup:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 378/1000 [00:30<00:18, 33.87it/s, 383 steps of size 3.03e-02. acc. prob=0.78]\rwarmup:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 382/1000 [00:30<00:23, 26.60it/s, 255 steps of size 3.88e-02. acc. prob=0.78]\rwarmup:  39%|â–ˆâ–ˆâ–ˆâ–Š      | 386/1000 [00:31<00:22, 27.43it/s, 127 steps of size 3.03e-02. acc. prob=0.78]\rwarmup:  39%|â–ˆâ–ˆâ–ˆâ–‰      | 390/1000 [00:31<00:21, 28.23it/s, 63 steps of size 4.20e-02. acc. prob=0.78] \rwarmup:  39%|â–ˆâ–ˆâ–ˆâ–‰      | 394/1000 [00:31<00:21, 28.76it/s, 63 steps of size 5.88e-02. acc. prob=0.78]\rwarmup:  40%|â–ˆâ–ˆâ–ˆâ–‰      | 399/1000 [00:31<00:18, 32.46it/s, 63 steps of size 9.95e-02. acc. prob=0.79]\rwarmup:  40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 403/1000 [00:31<00:21, 27.81it/s, 255 steps of size 4.60e-02. acc. prob=0.78]\rwarmup:  41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 407/1000 [00:31<00:19, 29.77it/s, 63 steps of size 6.42e-02. acc. prob=0.78] \rwarmup:  41%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 414/1000 [00:31<00:15, 38.23it/s, 31 steps of size 7.61e-02. acc. prob=0.79]\rwarmup:  42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 419/1000 [00:31<00:14, 38.76it/s, 63 steps of size 6.82e-02. acc. prob=0.79]\rwarmup:  42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 424/1000 [00:32<00:19, 29.21it/s, 127 steps of size 3.56e-02. acc. prob=0.78]\rwarmup:  43%|â–ˆâ–ˆâ–ˆâ–ˆâ–Ž     | 428/1000 [00:32<00:20, 28.07it/s, 127 steps of size 2.78e-02. acc. prob=0.78]\rwarmup:  43%|â–ˆâ–ˆâ–ˆâ–ˆâ–Ž     | 432/1000 [00:32<00:23, 24.65it/s, 191 steps of size 5.93e-02. acc. prob=0.79]\rwarmup:  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–Ž     | 435/1000 [00:32<00:23, 24.43it/s, 255 steps of size 4.13e-02. acc. prob=0.78]\rwarmup:  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 439/1000 [00:32<00:22, 25.31it/s, 255 steps of size 5.53e-02. acc. prob=0.79]\rwarmup:  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 442/1000 [00:33<00:21, 25.77it/s, 127 steps of size 3.91e-02. acc. prob=0.78]\rwarmup:  45%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 446/1000 [00:33<00:27, 20.20it/s, 767 steps of size 2.71e-02. acc. prob=0.78]\rwarmup:  45%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 449/1000 [00:33<00:37, 14.88it/s, 511 steps of size 3.85e-02. acc. prob=0.78]\rwarmup:  45%|â–ˆâ–ˆâ–ˆâ–ˆâ–Œ     | 451/1000 [00:33<00:37, 14.75it/s, 255 steps of size 2.52e-01. acc. prob=0.78]\rwarmup:  46%|â–ˆâ–ˆâ–ˆâ–ˆâ–Œ     | 456/1000 [00:33<00:28, 19.18it/s, 255 steps of size 2.77e-02. acc. prob=0.78]\rwarmup:  46%|â–ˆâ–ˆâ–ˆâ–ˆâ–Œ     | 460/1000 [00:34<00:29, 18.34it/s, 511 steps of size 1.84e-02. acc. prob=0.78]\rwarmup:  46%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 463/1000 [00:34<00:27, 19.53it/s, 63 steps of size 5.88e-03. acc. prob=0.78] \rwarmup:  47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 466/1000 [00:34<00:33, 15.93it/s, 255 steps of size 3.84e-02. acc. prob=0.78]\rwarmup:  47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 471/1000 [00:34<00:25, 20.94it/s, 127 steps of size 4.56e-02. acc. prob=0.78]\rwarmup:  48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 475/1000 [00:34<00:22, 22.91it/s, 255 steps of size 3.90e-02. acc. prob=0.78]\rwarmup:  48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 479/1000 [00:34<00:20, 25.68it/s, 127 steps of size 4.28e-02. acc. prob=0.78]\rwarmup:  48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 483/1000 [00:35<00:19, 26.57it/s, 255 steps of size 2.94e-02. acc. prob=0.78]\rwarmup:  49%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 487/1000 [00:35<00:17, 29.45it/s, 31 steps of size 2.36e-02. acc. prob=0.78] \rwarmup:  49%|â–ˆâ–ˆâ–ˆâ–ˆâ–‰     | 493/1000 [00:35<00:14, 34.24it/s, 127 steps of size 4.13e-02. acc. prob=0.78]\rwarmup:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–‰     | 499/1000 [00:35<00:12, 40.39it/s, 63 steps of size 9.70e-02. acc. prob=0.78] \rsample:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 505/1000 [00:35<00:11, 44.75it/s, 63 steps of size 5.97e-02. acc. prob=0.86]\rsample:  51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 510/1000 [00:35<00:11, 44.45it/s, 63 steps of size 5.97e-02. acc. prob=0.83]\rsample:  52%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 516/1000 [00:35<00:10, 46.71it/s, 63 steps of size 5.97e-02. acc. prob=0.82]\rsample:  52%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 522/1000 [00:35<00:09, 48.62it/s, 63 steps of size 5.97e-02. acc. prob=0.81]\rsample:  53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž    | 528/1000 [00:35<00:09, 49.48it/s, 63 steps of size 5.97e-02. acc. prob=0.76]\rsample:  53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž    | 534/1000 [00:36<00:09, 50.54it/s, 63 steps of size 5.97e-02. acc. prob=0.74]\rsample:  54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 540/1000 [00:36<00:09, 51.01it/s, 63 steps of size 5.97e-02. acc. prob=0.77]\rsample:  55%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 546/1000 [00:36<00:08, 51.41it/s, 63 steps of size 5.97e-02. acc. prob=0.74]\rsample:  55%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 552/1000 [00:36<00:08, 51.95it/s, 63 steps of size 5.97e-02. acc. prob=0.72]\rsample:  56%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 558/1000 [00:36<00:08, 52.48it/s, 63 steps of size 5.97e-02. acc. prob=0.73]\rsample:  56%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 564/1000 [00:36<00:08, 52.53it/s, 63 steps of size 5.97e-02. acc. prob=0.72]\rsample:  57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 570/1000 [00:36<00:08, 51.17it/s, 127 steps of size 5.97e-02. acc. prob=0.70]\rsample:  58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 576/1000 [00:36<00:08, 48.79it/s, 63 steps of size 5.97e-02. acc. prob=0.71] \rsample:  58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 581/1000 [00:37<00:09, 44.39it/s, 191 steps of size 5.97e-02. acc. prob=0.71]\rsample:  59%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 586/1000 [00:37<00:16, 24.68it/s, 127 steps of size 5.97e-02. acc. prob=0.68]\rsample:  59%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 590/1000 [00:37<00:18, 22.25it/s, 127 steps of size 5.97e-02. acc. prob=0.65]\rsample:  59%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 593/1000 [00:37<00:20, 19.88it/s, 63 steps of size 5.97e-02. acc. prob=0.65] \rsample:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 596/1000 [00:38<00:19, 21.01it/s, 255 steps of size 5.97e-02. acc. prob=0.64]\rsample:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 599/1000 [00:38<00:18, 21.74it/s, 255 steps of size 5.97e-02. acc. prob=0.63]\rsample:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 604/1000 [00:38<00:14, 26.80it/s, 63 steps of size 5.97e-02. acc. prob=0.62] \rsample:  61%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 608/1000 [00:38<00:13, 28.36it/s, 63 steps of size 5.97e-02. acc. prob=0.60]\rsample:  61%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 612/1000 [00:38<00:15, 24.56it/s, 127 steps of size 5.97e-02. acc. prob=0.59]\rsample:  62%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 615/1000 [00:38<00:18, 21.31it/s, 255 steps of size 5.97e-02. acc. prob=0.59]\rsample:  62%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 619/1000 [00:38<00:15, 24.40it/s, 191 steps of size 5.97e-02. acc. prob=0.58]\rsample:  62%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 622/1000 [00:39<00:15, 24.39it/s, 127 steps of size 5.97e-02. acc. prob=0.58]\rsample:  62%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž   | 625/1000 [00:39<00:16, 23.08it/s, 63 steps of size 5.97e-02. acc. prob=0.57] \rsample:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž   | 628/1000 [00:39<00:19, 19.48it/s, 375 steps of size 5.97e-02. acc. prob=0.56]\rsample:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž   | 632/1000 [00:39<00:16, 22.36it/s, 191 steps of size 5.97e-02. acc. prob=0.56]\rsample:  64%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž   | 635/1000 [00:39<00:16, 22.57it/s, 191 steps of size 5.97e-02. acc. prob=0.56]\rsample:  64%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 639/1000 [00:39<00:14, 25.66it/s, 63 steps of size 5.97e-02. acc. prob=0.55] \rsample:  64%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 644/1000 [00:39<00:11, 30.47it/s, 127 steps of size 5.97e-02. acc. prob=0.55]\rsample:  65%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 649/1000 [00:40<00:10, 33.87it/s, 95 steps of size 5.97e-02. acc. prob=0.54] \rsample:  66%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ   | 656/1000 [00:40<00:08, 39.76it/s, 127 steps of size 5.97e-02. acc. prob=0.53]\rsample:  66%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ   | 661/1000 [00:40<00:09, 36.06it/s, 63 steps of size 5.97e-02. acc. prob=0.52] \rsample:  66%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 665/1000 [00:40<00:10, 32.17it/s, 191 steps of size 5.97e-02. acc. prob=0.51]\rsample:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 670/1000 [00:40<00:10, 32.92it/s, 248 steps of size 5.97e-02. acc. prob=0.51]\rsample:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 674/1000 [00:40<00:10, 30.90it/s, 127 steps of size 5.97e-02. acc. prob=0.50]\rsample:  68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 678/1000 [00:40<00:10, 29.74it/s, 255 steps of size 5.97e-02. acc. prob=0.50]\rsample:  68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 682/1000 [00:41<00:10, 31.28it/s, 127 steps of size 5.97e-02. acc. prob=0.50]\rsample:  69%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 686/1000 [00:41<00:11, 27.43it/s, 127 steps of size 5.97e-02. acc. prob=0.49]\rsample:  69%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 689/1000 [00:41<00:12, 25.31it/s, 191 steps of size 5.97e-02. acc. prob=0.49]\rsample:  69%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 692/1000 [00:41<00:17, 17.81it/s, 191 steps of size 5.97e-02. acc. prob=0.48]\rsample:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 695/1000 [00:41<00:17, 17.52it/s, 31 steps of size 5.97e-02. acc. prob=0.48] \rsample:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 697/1000 [00:42<00:17, 17.61it/s, 255 steps of size 5.97e-02. acc. prob=0.47]\rsample:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 699/1000 [00:42<00:18, 16.41it/s, 255 steps of size 5.97e-02. acc. prob=0.47]\rsample:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 702/1000 [00:42<00:16, 17.77it/s, 159 steps of size 5.97e-02. acc. prob=0.47]\rsample:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 705/1000 [00:42<00:15, 19.19it/s, 191 steps of size 5.97e-02. acc. prob=0.46]\rsample:  71%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 710/1000 [00:42<00:12, 22.72it/s, 255 steps of size 5.97e-02. acc. prob=0.46]\rsample:  71%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 713/1000 [00:42<00:11, 24.20it/s, 155 steps of size 5.97e-02. acc. prob=0.46]\rsample:  72%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 716/1000 [00:42<00:12, 22.85it/s, 127 steps of size 5.97e-02. acc. prob=0.46]\rsample:  72%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 719/1000 [00:45<01:12,  3.89it/s, 63 steps of size 5.97e-02. acc. prob=0.46] \rsample:  72%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 722/1000 [00:45<00:53,  5.17it/s, 63 steps of size 5.97e-02. acc. prob=0.46]\rsample:  72%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 724/1000 [00:45<00:45,  6.10it/s, 255 steps of size 5.97e-02. acc. prob=0.46]\rsample:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž  | 728/1000 [00:45<00:33,  8.13it/s, 511 steps of size 5.97e-02. acc. prob=0.46]\rsample:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž  | 733/1000 [00:45<00:22, 12.07it/s, 63 steps of size 5.97e-02. acc. prob=0.47] \rsample:  74%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 739/1000 [00:45<00:14, 17.52it/s, 63 steps of size 5.97e-02. acc. prob=0.47]\rsample:  74%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 743/1000 [00:46<00:12, 19.79it/s, 127 steps of size 5.97e-02. acc. prob=0.46]\rsample:  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 747/1000 [00:46<00:12, 19.97it/s, 63 steps of size 5.97e-02. acc. prob=0.46] \rsample:  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 752/1000 [00:46<00:10, 23.56it/s, 191 steps of size 5.97e-02. acc. prob=0.47]\rsample:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 756/1000 [00:46<00:09, 25.64it/s, 63 steps of size 5.97e-02. acc. prob=0.47] \rsample:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 760/1000 [00:46<00:10, 22.91it/s, 63 steps of size 5.97e-02. acc. prob=0.47]\rsample:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹  | 764/1000 [00:46<00:09, 25.20it/s, 63 steps of size 5.97e-02. acc. prob=0.46]\rsample:  77%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹  | 767/1000 [00:47<00:10, 22.86it/s, 383 steps of size 5.97e-02. acc. prob=0.47]\rsample:  77%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹  | 772/1000 [00:47<00:08, 27.42it/s, 127 steps of size 5.97e-02. acc. prob=0.46]\rsample:  78%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 776/1000 [00:47<00:08, 27.24it/s, 63 steps of size 5.97e-02. acc. prob=0.46] \rsample:  78%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 782/1000 [00:47<00:06, 33.09it/s, 63 steps of size 5.97e-02. acc. prob=0.46]\rsample:  79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 786/1000 [00:47<00:08, 24.45it/s, 127 steps of size 5.97e-02. acc. prob=0.46]\rsample:  79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 790/1000 [00:47<00:07, 26.83it/s, 127 steps of size 5.97e-02. acc. prob=0.46]\rsample:  79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 794/1000 [00:47<00:07, 27.24it/s, 63 steps of size 5.97e-02. acc. prob=0.46] \rsample:  80%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 799/1000 [00:48<00:06, 31.07it/s, 63 steps of size 5.97e-02. acc. prob=0.45]\rsample:  80%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 803/1000 [00:48<00:06, 31.92it/s, 63 steps of size 5.97e-02. acc. prob=0.45]\rsample:  81%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 808/1000 [00:48<00:05, 34.21it/s, 127 steps of size 5.97e-02. acc. prob=0.45]\rsample:  81%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 812/1000 [00:48<00:05, 32.99it/s, 63 steps of size 5.97e-02. acc. prob=0.45] \rsample:  82%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 816/1000 [00:48<00:05, 33.60it/s, 127 steps of size 5.97e-02. acc. prob=0.44]\rsample:  82%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 820/1000 [00:48<00:07, 23.73it/s, 255 steps of size 5.97e-02. acc. prob=0.44]\rsample:  82%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 823/1000 [00:49<00:07, 22.25it/s, 255 steps of size 5.97e-02. acc. prob=0.44]\rsample:  83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 826/1000 [00:49<00:07, 22.94it/s, 63 steps of size 5.97e-02. acc. prob=0.44] \rsample:  83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 829/1000 [00:49<00:07, 21.57it/s, 63 steps of size 5.97e-02. acc. prob=0.44]\rsample:  83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 832/1000 [00:49<00:10, 15.93it/s, 511 steps of size 5.97e-02. acc. prob=0.44]\rsample:  83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 834/1000 [00:49<00:10, 16.27it/s, 319 steps of size 5.97e-02. acc. prob=0.44]\rsample:  84%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 836/1000 [00:49<00:11, 14.87it/s, 255 steps of size 5.97e-02. acc. prob=0.44]\rsample:  84%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 838/1000 [00:50<00:10, 15.43it/s, 255 steps of size 5.97e-02. acc. prob=0.44]\rsample:  84%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 841/1000 [00:50<00:09, 17.22it/s, 127 steps of size 5.97e-02. acc. prob=0.44]\rsample:  84%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 843/1000 [00:50<00:09, 16.74it/s, 255 steps of size 5.97e-02. acc. prob=0.44]\rsample:  85%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 846/1000 [00:50<00:08, 17.79it/s, 255 steps of size 5.97e-02. acc. prob=0.44]\rsample:  85%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 849/1000 [00:50<00:07, 20.10it/s, 127 steps of size 5.97e-02. acc. prob=0.44]\rsample:  85%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 852/1000 [00:50<00:08, 17.78it/s, 319 steps of size 5.97e-02. acc. prob=0.44]\rsample:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 855/1000 [00:50<00:07, 19.90it/s, 63 steps of size 5.97e-02. acc. prob=0.44] \rsample:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 859/1000 [00:51<00:06, 21.91it/s, 319 steps of size 5.97e-02. acc. prob=0.43]\rsample:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹ | 864/1000 [00:51<00:05, 25.23it/s, 255 steps of size 5.97e-02. acc. prob=0.44]\rsample:  87%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹ | 867/1000 [00:51<00:05, 25.89it/s, 63 steps of size 5.97e-02. acc. prob=0.44] \rsample:  87%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹ | 870/1000 [00:51<00:05, 26.00it/s, 191 steps of size 5.97e-02. acc. prob=0.44]\rsample:  87%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹ | 874/1000 [00:51<00:04, 26.26it/s, 255 steps of size 5.97e-02. acc. prob=0.44]\rsample:  88%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š | 878/1000 [00:51<00:05, 22.41it/s, 511 steps of size 5.97e-02. acc. prob=0.44]\rsample:  88%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š | 881/1000 [00:51<00:06, 19.28it/s, 127 steps of size 5.97e-02. acc. prob=0.44]\rsample:  89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š | 886/1000 [00:52<00:04, 24.48it/s, 127 steps of size 5.97e-02. acc. prob=0.43]\rsample:  89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 890/1000 [00:52<00:04, 27.05it/s, 191 steps of size 5.97e-02. acc. prob=0.43]\rsample:  89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 894/1000 [00:52<00:03, 27.75it/s, 63 steps of size 5.97e-02. acc. prob=0.43] \rsample:  90%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 897/1000 [00:52<00:04, 23.68it/s, 63 steps of size 5.97e-02. acc. prob=0.43]\rsample:  90%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 902/1000 [00:52<00:03, 28.46it/s, 63 steps of size 5.97e-02. acc. prob=0.43]\rsample:  91%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 906/1000 [00:52<00:04, 22.20it/s, 191 steps of size 5.97e-02. acc. prob=0.43]\rsample:  91%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 909/1000 [00:53<00:04, 21.70it/s, 63 steps of size 5.97e-02. acc. prob=0.43] \rsample:  91%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 912/1000 [00:53<00:04, 20.62it/s, 127 steps of size 5.97e-02. acc. prob=0.43]\rsample:  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 917/1000 [00:53<00:03, 25.91it/s, 63 steps of size 5.97e-02. acc. prob=0.44] \rsample:  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 920/1000 [00:53<00:03, 26.61it/s, 63 steps of size 5.97e-02. acc. prob=0.43]\rsample:  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 924/1000 [00:53<00:02, 28.19it/s, 127 steps of size 5.97e-02. acc. prob=0.43]\rsample:  93%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž| 928/1000 [00:53<00:02, 27.12it/s, 191 steps of size 5.97e-02. acc. prob=0.43]\rsample:  93%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž| 932/1000 [00:53<00:02, 28.51it/s, 127 steps of size 5.97e-02. acc. prob=0.42]\rsample:  94%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž| 936/1000 [00:53<00:02, 29.57it/s, 127 steps of size 5.97e-02. acc. prob=0.42]\rsample:  94%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 940/1000 [00:54<00:01, 30.38it/s, 63 steps of size 5.97e-02. acc. prob=0.42] \rsample:  95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 946/1000 [00:54<00:01, 36.98it/s, 63 steps of size 5.97e-02. acc. prob=0.42]\rsample:  95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 950/1000 [00:54<00:01, 36.80it/s, 63 steps of size 5.97e-02. acc. prob=0.43]\rsample:  95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 954/1000 [00:54<00:01, 30.05it/s, 63 steps of size 5.97e-02. acc. prob=0.43]\rsample:  96%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 960/1000 [00:54<00:01, 36.21it/s, 63 steps of size 5.97e-02. acc. prob=0.43]\rsample:  97%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹| 966/1000 [00:54<00:00, 36.23it/s, 255 steps of size 5.97e-02. acc. prob=0.44]\rsample:  97%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹| 971/1000 [00:54<00:00, 36.90it/s, 127 steps of size 5.97e-02. acc. prob=0.44]\rsample:  98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 977/1000 [00:55<00:00, 41.38it/s, 63 steps of size 5.97e-02. acc. prob=0.44] \rsample:  98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 982/1000 [00:55<00:00, 42.45it/s, 63 steps of size 5.97e-02. acc. prob=0.44]\rsample:  99%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 987/1000 [00:55<00:00, 36.51it/s, 255 steps of size 5.97e-02. acc. prob=0.45]\rsample:  99%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰| 992/1000 [00:55<00:00, 38.11it/s, 63 steps of size 5.97e-02. acc. prob=0.45] \rsample: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰| 997/1000 [00:55<00:00, 36.38it/s, 127 steps of size 5.97e-02. acc. prob=0.45]\rsample: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1000/1000 [00:55<00:00, 17.96it/s, 63 steps of size 5.97e-02. acc. prob=0.46]\n```\n:::\n:::\n\n\n## R\n\n``` r\n\n```\n![](travaux-routiers.png){fig-align=\"center\"}\n\n:::\n\n## Mathematical Details\n\nThe process involves two steps: first, assigning the data point to a cluster, and second, drawing it from that cluster's specific distribution. We use a truncation level $K$ as a finite approximation for the infinite number of possible clusters in a true Dirichlet Process.\n\n$$\n\\begin{aligned}\n\\begin{pmatrix}\nY_{i,1} \\\\\n\\vdots \\\\\nY_{i,D}\n\\end{pmatrix}\n&\\sim\n\\text{MVN}\\!\\left(\n\\begin{pmatrix}\n\\mu_{z_i,1} \\\\\n\\vdots \\\\\n\\mu_{z_i,D}\n\\end{pmatrix},\n\\,\n\\Sigma_{z_i}\n\\right) \\\\\n\\\\\n\\begin{pmatrix}\n\\mu_{k,1} \\\\\n\\vdots \\\\\n\\mu_{k,D}\n\\end{pmatrix}\n&\\sim\n\\text{MVN}\\!\\left(\n\\begin{pmatrix}\nA{k,1} \\\\\n\\vdots \\\\\nA{k,D}\n\\end{pmatrix},\n\\, B\n\\right) \\\\\n\\\\\n\\Sigma_k &= \\sigma_k \\Omega_k \\sigma_k \\\\\n\\\\\n\\sigma_k &\\sim \\text{HalfCauchy}(1) \\\\\n\\\\\n\\Omega_k &\\sim \\text{LKJ}(2) \\\\\n\\\\\nz_{i} &\\sim \\text{Categorical}(\\pi) \\\\\n\\\\\n\\pi  &= \\text{StickBreaking}(\\beta_1, ..., \\beta_{K}) \\\\\n\\\\\n\\beta_k &\\sim \\text{Beta}(1, \\alpha) \\\\\n\\\\\n\\alpha &\\sim \\text{Gamma}(1, 10) \\\\\n\\end{aligned}\n$$\n\nWhere : \n\n*   $\\begin{pmatrix} Y_{[i,1]} \\\\ \\vdots \\\\ Y_{[i,D]} \\end{pmatrix}$ is the $i$-th observation of a D-dimensional data array.\n\n*   $\\begin{pmatrix}\\mu_{[k,1]} \\\\ \\vdots \\\\ \\mu_{[k,D]}\\end{pmatrix}$ is the $k$-th parameter vector of dimension D.\n\n*   $\\begin{pmatrix} A_{[k,1]} \\\\ \\vdots \\\\ A_{[k,D]} \\end{pmatrix}$ is a prior for the $k$-th mean vector as derived by a *KMEANS* clustering algorithm. \n\n*   $B$ is the prior covariance of the cluster means, and is setup as a diagonal matrix with 0.1 along the diagonal.\n\n*   $\\Sigma_k$ is the DxD covariance matrix of the $k$-th cluster (it is composed from $\\sigma_k$ and $\\Omega_k$).\n\n*   $\\sigma_k$ is a diagonal matrix of standard deviations for the $k$-th cluster.\n\n*   $\\Omega_k$ is a correlation matrix for the $k$-th cluster.\n\n*   $z_i$ is a latent variable that maps observation $i$ to cluster $k$.\n\n*   $\\pi$ is a vector of $K$ cluster weights.\n  \n*   $\\beta_k$: The set of $K$ Beta-distributed random variables used in the stick-breaking process to construct the mixture weights.\n\n*   $\\alpha$: The concentration parameter, controlling the effective number of clusters. \n\n\n## Notes\n\n::: callout-note\nThe primary advantage of the DPMM over methods like K-Means or a GMM is the **automatic inference of the number of clusters**. Instead of running the model multiple times with different values of `K` and comparing them, the DPMM explores different numbers of clusters as part of its fitting process. The posterior distribution of the weights `w` reveals which components are \"active\" (have significant weight) and thus gives a probabilistic estimate of the number of clusters supported by the data.\n:::\n\n## Reference(s)\n\n@gershman2012tutorial\n\n",
    "supporting": [
      "21. DPMM_files/figure-html"
    ],
    "filters": [],
    "includes": {}
  }
}