{
  "hash": "43ad3370a9b9bb37bc21bf3119a751a8",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Univariate Linear Regression\"\ndescription: \"An introduction to linear regression models.\"\ncategories: [Regression]\nimage: \"Figures/regression_random_sampling.gif\"\norder: 2\nreading-time: true\n---\n\n## General Principles\n\nTo study relationships between a continuous independent variable and a continuous dependent variable (e.g., height and weight), we can use linear regression. Essentially, we draw a line that passes through the point cloud of the two variables being tested. For this, we need to have:\n\n1) An intercept $\\alpha$, which represents the origin of the line,i.e., the expected value of the dependent variable (height) when the independent variable (weight) is equal to zero.\n\n2) A coefficient $\\beta$, which informs us about the slope of the line. In other words, it tells us how much Y (height) increases for each increment of the independent variable (weight).\n\n3) A standard deviation term $\\sigma$, which informs us about the spread of points around the line, i.e., the variance around the prediction.\n\n\n## Considerations\n\n::: callout-note\n-   Bayesian models allow us to update our understanding of parameters conditional on an observed data set. This allows us to consider [<span style=\"color:#0D6EFD\">model parameter uncertainty ðŸ›ˆ</span>]{#uncertainty}, which quantifies our confidence or uncertainty in the parameters in the form of a [<span style=\"color:#0D6EFD\">posterior distribution ðŸ›ˆ</span>]{#posterior}. Therefore, we need to declare [<span style=\"color:#0D6EFD\">prior distributions ðŸ›ˆ</span>]{#prior} for each model parameter, in this case for: $\\alpha$, $\\beta$, and $\\sigma$.\n\n- Prior distributions are built following these considerations:\n\n  - As the data are [<span style=\"color:#0D6EFD\">normalizedðŸ›ˆ</span>]{#scaled} (see introduction), we can use a Normal distribution for $\\alpha$ and $\\beta$, with a mean of 0 and a standard deviation of 1. This tends to be a weakly regularizing prior, and weaker priors like a $Normal(0,10)$ are also possible.\n\n  - Since $\\sigma$ must be strictly positive, we must use a distribution with support on the positive reals, such as the *Exponential* or *Folded-Normal* distribution.\n\n- Gaussian regression deals directly with continuous outcomes, estimating a linear relationship between predictors and the outcome variable without depending on a non linear [<span style=\"color:#0D6EFD\">link function ðŸ›ˆ</span>]{#linkF} (see introduction). This simplifies interpretation, as coefficients represent direct changes in the outcome variable.\n\n\n:::\n\n## Example\n\nBelow is an example code snippet demonstrating *Bayesian linear regression* using the Bayesian Inference (**BI**) package. Data consist of two continuous variables (height and weight), and the goal is to estimate the effect of weight on height. This example is based on @mcelreath2018statistical.\n\n::: {.panel-tabset group=\"language\"}\n## Python\n\n::: {#24af9ea1 .cell execution_count=1}\n``` {.python .cell-code}\nfrom BI import bi\n\n# Setup device------------------------------------------------\nm = bi(platform='cpu')\n\n# Import Data & Data Manipulation ------------------------------------------------\n# Import\nfrom importlib.resources import files\ndata_path = files('BI.resources.data') / 'Howell1.csv'\nm.data(data_path, sep=';') \nm.df = m.df[m.df.age > 18] # Subset data to adults\nm.scale(['weight']) # Normalize\n\n# Define model ------------------------------------------------\ndef model(weight, height):    \n    a = m.dist.normal(178, 20, name = 'a') \n    b = m.dist.log_normal(0, 1, name = 'b') \n    s = m.dist.uniform(0, 50, name = 's') \n    m.dist.normal(a + b * weight , s, obs = height) \n\n# Run mcmc ------------------------------------------------\nm.fit(model)  # Optimize model parameters through MCMC sampling\n\n# Summary ------------------------------------------------\nm.summary() # Get posterior distributions\n```\n\n::: {.cell-output .cell-output-stdout}\n```\njax.local_device_count 16\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\r  0%|          | 0/1000 [00:00<?, ?it/s]\rwarmup:   0%|          | 1/1000 [00:01<22:14,  1.34s/it, 1 steps of size 2.34e+00. acc. prob=0.00]\rwarmup:  12%|â–ˆâ–        | 124/1000 [00:01<00:07, 119.43it/s, 19 steps of size 1.98e-01. acc. prob=0.77]\rwarmup:  25%|â–ˆâ–ˆâ–Œ       | 252/1000 [00:01<00:02, 260.01it/s, 1 steps of size 1.19e+00. acc. prob=0.78] \rwarmup:  39%|â–ˆâ–ˆâ–ˆâ–‰      | 388/1000 [00:01<00:01, 422.01it/s, 11 steps of size 4.95e-01. acc. prob=0.79]\rsample:  53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž    | 534/1000 [00:01<00:00, 602.09it/s, 3 steps of size 7.35e-01. acc. prob=0.93] \rsample:  68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 676/1000 [00:01<00:00, 763.95it/s, 3 steps of size 7.35e-01. acc. prob=0.93]\rsample:  81%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 814/1000 [00:01<00:00, 900.03it/s, 7 steps of size 7.35e-01. acc. prob=0.93]\rsample:  95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 947/1000 [00:02<00:00, 981.05it/s, 3 steps of size 7.35e-01. acc. prob=0.93]\rsample: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1000/1000 [00:02<00:00, 470.45it/s, 7 steps of size 7.35e-01. acc. prob=0.93]\narviz - WARNING - Shape validation failed: input_shape: (1, 500), minimum_shape: (chains=2, draws=4)\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=1}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>mean</th>\n      <th>sd</th>\n      <th>hdi_5.5%</th>\n      <th>hdi_94.5%</th>\n      <th>mcse_mean</th>\n      <th>mcse_sd</th>\n      <th>ess_bulk</th>\n      <th>ess_tail</th>\n      <th>r_hat</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>a</th>\n      <td>154.64</td>\n      <td>0.26</td>\n      <td>154.27</td>\n      <td>155.14</td>\n      <td>0.01</td>\n      <td>0.01</td>\n      <td>422.23</td>\n      <td>407.54</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>b</th>\n      <td>5.82</td>\n      <td>0.29</td>\n      <td>5.40</td>\n      <td>6.31</td>\n      <td>0.02</td>\n      <td>0.01</td>\n      <td>376.62</td>\n      <td>356.33</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>s</th>\n      <td>5.15</td>\n      <td>0.20</td>\n      <td>4.81</td>\n      <td>5.47</td>\n      <td>0.01</td>\n      <td>0.01</td>\n      <td>446.91</td>\n      <td>333.97</td>\n      <td>NaN</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## R\n\n``` r\nlibrary(BayesianInference)\nm <- importBI(platform = \"cpu\")\n\n# Load csv file\nm$data(paste(system.file(package = \"BayesianInference\"), \"/data/Howell1.csv\", sep = \"\"), sep = \";\")\n\n# Filter data frame\nm$df <- m$df[m$df$age > 18, ] # Subset data to adults\n\n# Scale\nm$scale(list(\"weight\")) # Normalize\n\n# Convert data to JAX arrays\nm$data_to_model(list(\"weight\", \"height\"))\n\n# Define model ------------------------------------------------\nmodel <- function(height, weight) {\n    # Parameter prior distributions\n    s <- bi.dist.uniform(0, 50, name = \"s\")\n    a <- bi.dist.normal(178, 20, name = \"a\")\n    b <- bi.dist.normal(0, 1, name = \"b\")\n\n    # Likelihood\n    bi.dist.normal(a + b * weight, s, obs = height)\n}\n\n# Run MCMC ------------------------------------------------\nm$fit(model) # Optimize model parameters through MCMC sampling\n\n# Summary ------------------------------------------------\nm$summary()\n``` \n:::\n\n## Mathematical Details\n\n### *Frequentist Formulation*\n\nThe following equation describe the frequentist formulation of linear regression:\n\n$$\nY_i = \\alpha + \\beta  X_i + \\epsilon_i\n$$\n\nWhere:\n\n-   $Y_i$ is the dependent variable for observation *i*.\n\n-   $\\alpha$ is the intercept term.\n\n-   $\\beta$ is the regression coefficient.\n\n-   $X_i$ is the input variable for observation *i*.\n\n-   $\\epsilon_i$ is the error term for observation *i*, and the vector of the error terms, $\\epsilon$, are assumed to be independent and identically distributed.\n\n### *Bayesian Formulation*\n\nIn the Bayesian formulation, we define each parameter with [<span style=\"color:#0D6EFD\">priors ðŸ›ˆ</span>]{#prior}. We can express a Bayesian version of this regression model using the following model:\n\n$$\nY_i \\sim \\text{Normal}(\\alpha + \\beta   X_i, \\sigma)\n$$\n\n$$\n\\alpha \\sim \\text{Normal}(0, 1)\n$$\n\n$$\n\\beta \\sim \\text{Normal}(0, 1)\n$$\n\n$$\n\\sigma \\sim \\text{Uniform}(0, 50)\n$$\n\nWhere:\n\n-   $Y_i$ is the dependent variable for observation *i*.\n\n-   $\\alpha$ and $\\beta$ are the intercept and regression coefficient, respectively.\n\n-   $X_i$ is the independent variable for observation *i*.\n\n-   $\\sigma$ is the standard deviation of the Normal distribution, which describes the variance in the relationship between the dependent variable $Y$ and the independent variable $X$.\n\n\n## Notes\n::: callout-note\nWe observe a difference between the *Frequentist* and the *Bayesian* formulation regarding the error term. Indeed, in the *Frequentist* formulation, the error term $\\epsilon$ represents residual fluctuations around the predicted values. This assumption leads to point estimates for $\\alpha$ and $\\beta$. In contrast, the *Bayesian* formulation treats $\\sigma$ as a parameter with its own prior distribution. This allows us to incorporate our uncertainty about the error term into the model.\n:::\n\n## Reference(s)\n\n\n::: {#refs}\n:::\n\n",
    "supporting": [
      "1. Linear Regression for continuous variable_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}