{
  "hash": "afb3df99934d2ddbd49e3d35a3eee57c",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Varying Intercepts Models\"\ndescription: \"Modeling grouped or hierarchical data by allowing the intercept to vary for each group.\"\ncategories: [Hierarchical Models, Regression]\nimage: \"Figures/13.png\"\norder: 16\n---\n\n\n\n\n\n\n\n## General Principles\n\nTo model the relationship between a dependent variable and an independent variable while allowing for different intercepts across groups or clusters, we can use a *Varying Intercepts* model. This approach is particularly useful when data are grouped (e.g., by subject, location, or time period) and we expect the baseline level of the outcome to vary across these groups.\n\n## Considerations\n\n::: callout-note\n- We have the same considerations as for [Regression for a continuous variable](1.&#32;Linear&#32;Regression&#32;for&#32;continuous&#32;variable.qmd).\n\n- The main idea of varying intercepts is to generate an intercept for each group, allowing each group to start at different levels. Thus, the intercept $\\alpha_k$ is defined uniquely for each of the $K$ declared groups.\n\n- In the code below, the intercept ```alpha``` for each of the $k$ declared groups shares two priors, ```a_bar``` and ```sigma```, which are respectively modeled by a Normal and an Exponential distribution.\n\n:::\n\n## Example\n\nBelow is an example code snippet demonstrating Bayesian regression with varying intercepts using the Bayesian Inference (BI) package. The data consists of a dependent variable representing individuals' survival (*surv*) and an independent categorical variable (*tank*), which indicates the tank where the individual was born, with a total of 48 tanks. This example is based on @mcelreath2018statistical.\n\n::: {.panel-tabset group=\"language\"}\n## Python (Raw)\n\n::: {#aff91512 .cell execution_count=1}\n``` {.python .cell-code}\nfrom BI import bi, jnp\n\n# Setup device------------------------------------------------\nm = bi(platform='cpu')\n\n# Import Data & Data Manipulation ------------------------------------------------\n# Import\nfrom importlib.resources import files\ndata_path = m.load.reedfrogs(only_path=True)\nm.data(data_path, sep=';') \n# Manipulate\nm.df[\"tank\"] = jnp.arange(m.df.shape[0]) \n\n# Define model ------------------------------------------------\ndef model(tank, surv, density):\n    sigma = m.dist.exponential( 1,  name = 'sigma')\n    a_bar = m.dist.normal( 0., 1.5,  name = 'a_bar')\n    alpha = m.dist.normal( a_bar, sigma, shape= tank.shape, name = 'alpha')\n    p = alpha[tank]\n    m.dist.binomial(total_count = density, logits = p, obs=surv)\n\n# Run sampler ------------------------------------------------\nm.fit(model) \n\n# Diagnostic ------------------------------------------------\nm.summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\njax.local_device_count 32\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\r  0%|          | 0/1000 [00:00<?, ?it/s]\rwarmup:   0%|          | 1/1000 [00:00<09:35,  1.73it/s, 1 steps of size 2.34e+00. acc. prob=0.00]\rwarmup:  21%|██        | 207/1000 [00:00<00:01, 410.44it/s, 15 steps of size 4.31e-01. acc. prob=0.78]\rwarmup:  45%|████▌     | 454/1000 [00:00<00:00, 864.93it/s, 15 steps of size 4.90e-01. acc. prob=0.79]\rsample:  70%|███████   | 701/1000 [00:00<00:00, 1249.73it/s, 7 steps of size 4.21e-01. acc. prob=0.90]\rsample:  97%|█████████▋| 969/1000 [00:00<00:00, 1613.52it/s, 7 steps of size 4.21e-01. acc. prob=0.90]\rsample: 100%|██████████| 1000/1000 [00:00<00:00, 1009.84it/s, 7 steps of size 4.21e-01. acc. prob=0.89]\narviz - WARNING - Shape validation failed: input_shape: (1, 500), minimum_shape: (chains=2, draws=4)\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>mean</th>\n      <th>sd</th>\n      <th>hdi_5.5%</th>\n      <th>hdi_94.5%</th>\n      <th>mcse_mean</th>\n      <th>mcse_sd</th>\n      <th>ess_bulk</th>\n      <th>ess_tail</th>\n      <th>r_hat</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>a_bar</th>\n      <td>1.35</td>\n      <td>0.27</td>\n      <td>0.95</td>\n      <td>1.79</td>\n      <td>0.01</td>\n      <td>0.01</td>\n      <td>467.13</td>\n      <td>297.56</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[0]</th>\n      <td>2.13</td>\n      <td>0.85</td>\n      <td>0.69</td>\n      <td>3.34</td>\n      <td>0.04</td>\n      <td>0.04</td>\n      <td>514.75</td>\n      <td>388.20</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[1]</th>\n      <td>3.09</td>\n      <td>1.09</td>\n      <td>1.30</td>\n      <td>4.47</td>\n      <td>0.05</td>\n      <td>0.05</td>\n      <td>565.53</td>\n      <td>436.09</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[2]</th>\n      <td>0.99</td>\n      <td>0.68</td>\n      <td>0.06</td>\n      <td>2.14</td>\n      <td>0.03</td>\n      <td>0.04</td>\n      <td>676.80</td>\n      <td>327.00</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[3]</th>\n      <td>3.12</td>\n      <td>1.10</td>\n      <td>1.27</td>\n      <td>4.66</td>\n      <td>0.05</td>\n      <td>0.06</td>\n      <td>594.03</td>\n      <td>428.01</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[4]</th>\n      <td>2.15</td>\n      <td>0.89</td>\n      <td>0.82</td>\n      <td>3.57</td>\n      <td>0.03</td>\n      <td>0.04</td>\n      <td>726.38</td>\n      <td>463.33</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[5]</th>\n      <td>2.19</td>\n      <td>0.91</td>\n      <td>0.87</td>\n      <td>3.66</td>\n      <td>0.04</td>\n      <td>0.05</td>\n      <td>771.96</td>\n      <td>371.60</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[6]</th>\n      <td>3.12</td>\n      <td>1.07</td>\n      <td>1.57</td>\n      <td>4.72</td>\n      <td>0.05</td>\n      <td>0.04</td>\n      <td>520.47</td>\n      <td>347.62</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[7]</th>\n      <td>2.14</td>\n      <td>0.87</td>\n      <td>0.73</td>\n      <td>3.38</td>\n      <td>0.03</td>\n      <td>0.05</td>\n      <td>1221.40</td>\n      <td>424.56</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[8]</th>\n      <td>-0.16</td>\n      <td>0.62</td>\n      <td>-1.02</td>\n      <td>0.94</td>\n      <td>0.02</td>\n      <td>0.04</td>\n      <td>811.97</td>\n      <td>219.25</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[9]</th>\n      <td>2.10</td>\n      <td>0.86</td>\n      <td>0.67</td>\n      <td>3.33</td>\n      <td>0.04</td>\n      <td>0.04</td>\n      <td>513.47</td>\n      <td>370.85</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[10]</th>\n      <td>0.99</td>\n      <td>0.69</td>\n      <td>-0.13</td>\n      <td>2.03</td>\n      <td>0.02</td>\n      <td>0.03</td>\n      <td>927.72</td>\n      <td>411.04</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[11]</th>\n      <td>0.62</td>\n      <td>0.65</td>\n      <td>-0.49</td>\n      <td>1.61</td>\n      <td>0.03</td>\n      <td>0.03</td>\n      <td>561.63</td>\n      <td>290.42</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[12]</th>\n      <td>1.05</td>\n      <td>0.72</td>\n      <td>-0.12</td>\n      <td>2.05</td>\n      <td>0.03</td>\n      <td>0.04</td>\n      <td>708.09</td>\n      <td>317.39</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[13]</th>\n      <td>0.18</td>\n      <td>0.62</td>\n      <td>-0.83</td>\n      <td>1.18</td>\n      <td>0.02</td>\n      <td>0.03</td>\n      <td>680.04</td>\n      <td>406.36</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[14]</th>\n      <td>2.16</td>\n      <td>0.84</td>\n      <td>0.69</td>\n      <td>3.32</td>\n      <td>0.03</td>\n      <td>0.04</td>\n      <td>843.95</td>\n      <td>375.45</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[15]</th>\n      <td>2.15</td>\n      <td>0.91</td>\n      <td>0.80</td>\n      <td>3.65</td>\n      <td>0.04</td>\n      <td>0.04</td>\n      <td>499.23</td>\n      <td>283.02</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[16]</th>\n      <td>2.91</td>\n      <td>0.79</td>\n      <td>1.42</td>\n      <td>3.86</td>\n      <td>0.03</td>\n      <td>0.04</td>\n      <td>716.71</td>\n      <td>353.12</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[17]</th>\n      <td>2.40</td>\n      <td>0.67</td>\n      <td>1.30</td>\n      <td>3.38</td>\n      <td>0.03</td>\n      <td>0.04</td>\n      <td>727.24</td>\n      <td>247.66</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[18]</th>\n      <td>2.03</td>\n      <td>0.60</td>\n      <td>1.10</td>\n      <td>2.91</td>\n      <td>0.03</td>\n      <td>0.03</td>\n      <td>642.62</td>\n      <td>326.17</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[19]</th>\n      <td>3.75</td>\n      <td>0.95</td>\n      <td>2.17</td>\n      <td>5.10</td>\n      <td>0.04</td>\n      <td>0.04</td>\n      <td>582.43</td>\n      <td>361.94</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[20]</th>\n      <td>2.35</td>\n      <td>0.61</td>\n      <td>1.41</td>\n      <td>3.24</td>\n      <td>0.02</td>\n      <td>0.03</td>\n      <td>824.43</td>\n      <td>261.58</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[21]</th>\n      <td>2.36</td>\n      <td>0.66</td>\n      <td>1.34</td>\n      <td>3.37</td>\n      <td>0.02</td>\n      <td>0.03</td>\n      <td>761.56</td>\n      <td>320.99</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[22]</th>\n      <td>2.40</td>\n      <td>0.62</td>\n      <td>1.37</td>\n      <td>3.31</td>\n      <td>0.03</td>\n      <td>0.03</td>\n      <td>573.35</td>\n      <td>352.38</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[23]</th>\n      <td>1.70</td>\n      <td>0.53</td>\n      <td>0.93</td>\n      <td>2.56</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>839.61</td>\n      <td>423.04</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[24]</th>\n      <td>-1.03</td>\n      <td>0.45</td>\n      <td>-1.69</td>\n      <td>-0.33</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>731.40</td>\n      <td>365.09</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[25]</th>\n      <td>0.16</td>\n      <td>0.42</td>\n      <td>-0.48</td>\n      <td>0.83</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>651.44</td>\n      <td>369.19</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[26]</th>\n      <td>-1.41</td>\n      <td>0.45</td>\n      <td>-2.15</td>\n      <td>-0.71</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>597.70</td>\n      <td>314.86</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[27]</th>\n      <td>-0.48</td>\n      <td>0.42</td>\n      <td>-1.08</td>\n      <td>0.19</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>537.11</td>\n      <td>388.83</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[28]</th>\n      <td>0.16</td>\n      <td>0.40</td>\n      <td>-0.61</td>\n      <td>0.67</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>431.36</td>\n      <td>392.36</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[29]</th>\n      <td>1.46</td>\n      <td>0.48</td>\n      <td>0.75</td>\n      <td>2.27</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>755.76</td>\n      <td>404.80</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[30]</th>\n      <td>-0.62</td>\n      <td>0.43</td>\n      <td>-1.18</td>\n      <td>0.20</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>706.26</td>\n      <td>394.05</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[31]</th>\n      <td>-0.30</td>\n      <td>0.43</td>\n      <td>-0.90</td>\n      <td>0.41</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>692.89</td>\n      <td>408.34</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[32]</th>\n      <td>3.20</td>\n      <td>0.76</td>\n      <td>2.04</td>\n      <td>4.48</td>\n      <td>0.03</td>\n      <td>0.03</td>\n      <td>563.22</td>\n      <td>379.37</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[33]</th>\n      <td>2.70</td>\n      <td>0.64</td>\n      <td>1.83</td>\n      <td>3.88</td>\n      <td>0.02</td>\n      <td>0.03</td>\n      <td>758.59</td>\n      <td>428.71</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[34]</th>\n      <td>2.74</td>\n      <td>0.65</td>\n      <td>1.65</td>\n      <td>3.71</td>\n      <td>0.03</td>\n      <td>0.03</td>\n      <td>545.98</td>\n      <td>387.72</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[35]</th>\n      <td>2.06</td>\n      <td>0.49</td>\n      <td>1.36</td>\n      <td>2.94</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>721.44</td>\n      <td>392.52</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[36]</th>\n      <td>2.09</td>\n      <td>0.57</td>\n      <td>1.25</td>\n      <td>2.95</td>\n      <td>0.02</td>\n      <td>0.03</td>\n      <td>732.34</td>\n      <td>371.66</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[37]</th>\n      <td>3.89</td>\n      <td>0.95</td>\n      <td>2.29</td>\n      <td>5.11</td>\n      <td>0.04</td>\n      <td>0.05</td>\n      <td>508.53</td>\n      <td>294.22</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[38]</th>\n      <td>2.70</td>\n      <td>0.70</td>\n      <td>1.66</td>\n      <td>3.76</td>\n      <td>0.03</td>\n      <td>0.05</td>\n      <td>696.43</td>\n      <td>275.91</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[39]</th>\n      <td>2.38</td>\n      <td>0.54</td>\n      <td>1.46</td>\n      <td>3.19</td>\n      <td>0.02</td>\n      <td>0.03</td>\n      <td>588.18</td>\n      <td>352.03</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[40]</th>\n      <td>-1.77</td>\n      <td>0.47</td>\n      <td>-2.50</td>\n      <td>-1.03</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>965.46</td>\n      <td>269.98</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[41]</th>\n      <td>-0.59</td>\n      <td>0.31</td>\n      <td>-1.09</td>\n      <td>-0.13</td>\n      <td>0.01</td>\n      <td>0.01</td>\n      <td>729.57</td>\n      <td>401.86</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[42]</th>\n      <td>-0.44</td>\n      <td>0.37</td>\n      <td>-1.04</td>\n      <td>0.16</td>\n      <td>0.01</td>\n      <td>0.02</td>\n      <td>744.12</td>\n      <td>373.34</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[43]</th>\n      <td>-0.33</td>\n      <td>0.36</td>\n      <td>-0.90</td>\n      <td>0.23</td>\n      <td>0.01</td>\n      <td>0.02</td>\n      <td>818.64</td>\n      <td>313.40</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[44]</th>\n      <td>0.57</td>\n      <td>0.34</td>\n      <td>0.07</td>\n      <td>1.09</td>\n      <td>0.02</td>\n      <td>0.01</td>\n      <td>487.25</td>\n      <td>426.63</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[45]</th>\n      <td>-0.58</td>\n      <td>0.38</td>\n      <td>-1.25</td>\n      <td>-0.04</td>\n      <td>0.01</td>\n      <td>0.02</td>\n      <td>1084.06</td>\n      <td>421.32</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[46]</th>\n      <td>2.06</td>\n      <td>0.46</td>\n      <td>1.34</td>\n      <td>2.75</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>569.86</td>\n      <td>389.45</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>alpha[47]</th>\n      <td>0.02</td>\n      <td>0.35</td>\n      <td>-0.50</td>\n      <td>0.61</td>\n      <td>0.01</td>\n      <td>0.02</td>\n      <td>710.85</td>\n      <td>353.56</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>sigma</th>\n      <td>1.62</td>\n      <td>0.21</td>\n      <td>1.30</td>\n      <td>1.92</td>\n      <td>0.01</td>\n      <td>0.01</td>\n      <td>339.24</td>\n      <td>267.98</td>\n      <td>NaN</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## Python (Build in function)\n\n::: {#30e6de78 .cell execution_count=2}\n``` {.python .cell-code}\nfrom BI import bi, jnp\n\n\n# Setup device------------------------------------------------\nm = bi(platform='cpu')\n\n# Import Data & Data Manipulation ------------------------------------------------\n# Import\nfrom importlib.resources import files\ndata_path =  m.load.reedfrogs(only_path=True)\nm.data(data_path, sep=';') \n# Manipulate\nm.df[\"tank\"] = jnp.arange(m.df.shape[0]) \n\n# Define model ------------------------------------------------\ndef model(tank, surv, density):\n    alpha = m.effects.varying_intercept(N_groups=48,group_id=tank, group_name = 'tank')\n    m.dist.binomial(total_count = density, logits = alpha, obs=surv)\n\n# Run sampler ------------------------------------------------\nm.fit(model) \n\n# Diagnostic ------------------------------------------------\nm.summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\njax.local_device_count 32\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\r  0%|          | 0/1000 [00:00<?, ?it/s]\rwarmup:   0%|          | 1/1000 [00:00<07:16,  2.29it/s, 1 steps of size 2.34e+00. acc. prob=0.00]\rwarmup:  17%|█▋        | 170/1000 [00:00<00:01, 417.73it/s, 7 steps of size 2.37e-01. acc. prob=0.78]\rwarmup:  43%|████▎     | 430/1000 [00:00<00:00, 985.46it/s, 7 steps of size 4.61e-01. acc. prob=0.79]\rsample:  74%|███████▍  | 741/1000 [00:00<00:00, 1560.58it/s, 7 steps of size 4.53e-01. acc. prob=0.88]\rsample: 100%|██████████| 1000/1000 [00:00<00:00, 1220.19it/s, 7 steps of size 4.53e-01. acc. prob=0.88]\narviz - WARNING - Shape validation failed: input_shape: (1, 500), minimum_shape: (chains=2, draws=4)\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=4}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>mean</th>\n      <th>sd</th>\n      <th>hdi_5.5%</th>\n      <th>hdi_94.5%</th>\n      <th>mcse_mean</th>\n      <th>mcse_sd</th>\n      <th>ess_bulk</th>\n      <th>ess_tail</th>\n      <th>r_hat</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>global_intercept_tank</th>\n      <td>1.36</td>\n      <td>0.26</td>\n      <td>0.94</td>\n      <td>1.77</td>\n      <td>0.01</td>\n      <td>0.01</td>\n      <td>563.88</td>\n      <td>182.64</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[0]</th>\n      <td>2.10</td>\n      <td>0.86</td>\n      <td>0.72</td>\n      <td>3.38</td>\n      <td>0.03</td>\n      <td>0.04</td>\n      <td>811.23</td>\n      <td>369.49</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[1]</th>\n      <td>3.04</td>\n      <td>1.11</td>\n      <td>1.31</td>\n      <td>4.69</td>\n      <td>0.05</td>\n      <td>0.06</td>\n      <td>592.21</td>\n      <td>290.26</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[2]</th>\n      <td>1.00</td>\n      <td>0.65</td>\n      <td>-0.06</td>\n      <td>2.06</td>\n      <td>0.03</td>\n      <td>0.04</td>\n      <td>647.60</td>\n      <td>343.02</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[3]</th>\n      <td>3.06</td>\n      <td>1.10</td>\n      <td>1.16</td>\n      <td>4.67</td>\n      <td>0.05</td>\n      <td>0.07</td>\n      <td>547.75</td>\n      <td>178.68</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[4]</th>\n      <td>2.14</td>\n      <td>0.89</td>\n      <td>0.80</td>\n      <td>3.44</td>\n      <td>0.03</td>\n      <td>0.05</td>\n      <td>953.17</td>\n      <td>307.45</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[5]</th>\n      <td>2.15</td>\n      <td>0.89</td>\n      <td>0.91</td>\n      <td>3.72</td>\n      <td>0.03</td>\n      <td>0.04</td>\n      <td>850.84</td>\n      <td>421.61</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[6]</th>\n      <td>3.13</td>\n      <td>1.11</td>\n      <td>1.40</td>\n      <td>4.93</td>\n      <td>0.06</td>\n      <td>0.06</td>\n      <td>455.95</td>\n      <td>282.69</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[7]</th>\n      <td>2.18</td>\n      <td>0.89</td>\n      <td>1.00</td>\n      <td>3.73</td>\n      <td>0.04</td>\n      <td>0.04</td>\n      <td>504.63</td>\n      <td>338.18</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[8]</th>\n      <td>-0.16</td>\n      <td>0.62</td>\n      <td>-1.02</td>\n      <td>0.89</td>\n      <td>0.02</td>\n      <td>0.03</td>\n      <td>602.28</td>\n      <td>387.08</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[9]</th>\n      <td>2.15</td>\n      <td>0.92</td>\n      <td>0.81</td>\n      <td>3.47</td>\n      <td>0.04</td>\n      <td>0.06</td>\n      <td>588.68</td>\n      <td>335.17</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[10]</th>\n      <td>1.00</td>\n      <td>0.70</td>\n      <td>0.03</td>\n      <td>2.17</td>\n      <td>0.02</td>\n      <td>0.04</td>\n      <td>921.27</td>\n      <td>305.21</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[11]</th>\n      <td>0.58</td>\n      <td>0.61</td>\n      <td>-0.31</td>\n      <td>1.64</td>\n      <td>0.02</td>\n      <td>0.03</td>\n      <td>718.11</td>\n      <td>320.40</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[12]</th>\n      <td>1.07</td>\n      <td>0.69</td>\n      <td>-0.06</td>\n      <td>2.08</td>\n      <td>0.03</td>\n      <td>0.03</td>\n      <td>511.78</td>\n      <td>369.19</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[13]</th>\n      <td>0.20</td>\n      <td>0.60</td>\n      <td>-0.69</td>\n      <td>1.20</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>646.21</td>\n      <td>339.77</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[14]</th>\n      <td>2.12</td>\n      <td>0.83</td>\n      <td>0.90</td>\n      <td>3.52</td>\n      <td>0.04</td>\n      <td>0.04</td>\n      <td>563.92</td>\n      <td>353.53</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[15]</th>\n      <td>2.15</td>\n      <td>0.91</td>\n      <td>0.69</td>\n      <td>3.50</td>\n      <td>0.04</td>\n      <td>0.05</td>\n      <td>565.23</td>\n      <td>355.31</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[16]</th>\n      <td>2.87</td>\n      <td>0.76</td>\n      <td>1.74</td>\n      <td>4.10</td>\n      <td>0.03</td>\n      <td>0.03</td>\n      <td>918.26</td>\n      <td>411.31</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[17]</th>\n      <td>2.42</td>\n      <td>0.68</td>\n      <td>1.36</td>\n      <td>3.40</td>\n      <td>0.03</td>\n      <td>0.05</td>\n      <td>642.69</td>\n      <td>209.59</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[18]</th>\n      <td>2.03</td>\n      <td>0.60</td>\n      <td>0.95</td>\n      <td>2.83</td>\n      <td>0.03</td>\n      <td>0.02</td>\n      <td>460.37</td>\n      <td>346.04</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[19]</th>\n      <td>3.73</td>\n      <td>1.04</td>\n      <td>2.02</td>\n      <td>5.18</td>\n      <td>0.05</td>\n      <td>0.05</td>\n      <td>587.35</td>\n      <td>381.98</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[20]</th>\n      <td>2.38</td>\n      <td>0.64</td>\n      <td>1.47</td>\n      <td>3.46</td>\n      <td>0.03</td>\n      <td>0.03</td>\n      <td>592.59</td>\n      <td>386.77</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[21]</th>\n      <td>2.39</td>\n      <td>0.69</td>\n      <td>1.30</td>\n      <td>3.37</td>\n      <td>0.03</td>\n      <td>0.03</td>\n      <td>622.27</td>\n      <td>322.91</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[22]</th>\n      <td>2.42</td>\n      <td>0.65</td>\n      <td>1.26</td>\n      <td>3.35</td>\n      <td>0.03</td>\n      <td>0.04</td>\n      <td>435.39</td>\n      <td>247.89</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[23]</th>\n      <td>1.69</td>\n      <td>0.53</td>\n      <td>0.88</td>\n      <td>2.48</td>\n      <td>0.02</td>\n      <td>0.03</td>\n      <td>676.05</td>\n      <td>393.95</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[24]</th>\n      <td>-1.00</td>\n      <td>0.48</td>\n      <td>-1.69</td>\n      <td>-0.26</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>792.69</td>\n      <td>344.82</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[25]</th>\n      <td>0.14</td>\n      <td>0.40</td>\n      <td>-0.44</td>\n      <td>0.81</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>570.16</td>\n      <td>385.30</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[26]</th>\n      <td>-1.42</td>\n      <td>0.48</td>\n      <td>-2.04</td>\n      <td>-0.54</td>\n      <td>0.02</td>\n      <td>0.03</td>\n      <td>699.69</td>\n      <td>349.23</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[27]</th>\n      <td>-0.50</td>\n      <td>0.42</td>\n      <td>-1.12</td>\n      <td>0.17</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>482.27</td>\n      <td>381.98</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[28]</th>\n      <td>0.15</td>\n      <td>0.39</td>\n      <td>-0.39</td>\n      <td>0.82</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>655.74</td>\n      <td>295.17</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[29]</th>\n      <td>1.44</td>\n      <td>0.48</td>\n      <td>0.66</td>\n      <td>2.19</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>491.85</td>\n      <td>336.45</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[30]</th>\n      <td>-0.62</td>\n      <td>0.42</td>\n      <td>-1.24</td>\n      <td>0.11</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>601.10</td>\n      <td>369.15</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[31]</th>\n      <td>-0.28</td>\n      <td>0.44</td>\n      <td>-0.96</td>\n      <td>0.37</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>587.55</td>\n      <td>285.26</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[32]</th>\n      <td>3.18</td>\n      <td>0.72</td>\n      <td>2.05</td>\n      <td>4.19</td>\n      <td>0.03</td>\n      <td>0.03</td>\n      <td>481.03</td>\n      <td>336.93</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[33]</th>\n      <td>2.67</td>\n      <td>0.62</td>\n      <td>1.57</td>\n      <td>3.49</td>\n      <td>0.02</td>\n      <td>0.03</td>\n      <td>735.44</td>\n      <td>289.00</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[34]</th>\n      <td>2.75</td>\n      <td>0.62</td>\n      <td>1.76</td>\n      <td>3.73</td>\n      <td>0.03</td>\n      <td>0.03</td>\n      <td>388.61</td>\n      <td>347.85</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[35]</th>\n      <td>2.06</td>\n      <td>0.47</td>\n      <td>1.27</td>\n      <td>2.80</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>840.45</td>\n      <td>343.02</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[36]</th>\n      <td>2.09</td>\n      <td>0.53</td>\n      <td>1.32</td>\n      <td>2.91</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>756.53</td>\n      <td>393.66</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[37]</th>\n      <td>3.90</td>\n      <td>0.95</td>\n      <td>2.47</td>\n      <td>5.27</td>\n      <td>0.05</td>\n      <td>0.04</td>\n      <td>336.15</td>\n      <td>304.76</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[38]</th>\n      <td>2.70</td>\n      <td>0.67</td>\n      <td>1.72</td>\n      <td>3.72</td>\n      <td>0.03</td>\n      <td>0.04</td>\n      <td>665.74</td>\n      <td>311.83</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[39]</th>\n      <td>2.34</td>\n      <td>0.53</td>\n      <td>1.45</td>\n      <td>3.15</td>\n      <td>0.02</td>\n      <td>0.03</td>\n      <td>738.32</td>\n      <td>281.88</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[40]</th>\n      <td>-1.78</td>\n      <td>0.45</td>\n      <td>-2.48</td>\n      <td>-1.06</td>\n      <td>0.01</td>\n      <td>0.02</td>\n      <td>913.76</td>\n      <td>357.43</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[41]</th>\n      <td>-0.58</td>\n      <td>0.34</td>\n      <td>-1.14</td>\n      <td>-0.07</td>\n      <td>0.01</td>\n      <td>0.01</td>\n      <td>730.83</td>\n      <td>425.09</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[42]</th>\n      <td>-0.44</td>\n      <td>0.39</td>\n      <td>-1.03</td>\n      <td>0.21</td>\n      <td>0.01</td>\n      <td>0.02</td>\n      <td>693.24</td>\n      <td>438.47</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[43]</th>\n      <td>-0.33</td>\n      <td>0.34</td>\n      <td>-0.86</td>\n      <td>0.20</td>\n      <td>0.01</td>\n      <td>0.02</td>\n      <td>549.94</td>\n      <td>352.19</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[44]</th>\n      <td>0.58</td>\n      <td>0.33</td>\n      <td>0.06</td>\n      <td>1.09</td>\n      <td>0.01</td>\n      <td>0.01</td>\n      <td>653.17</td>\n      <td>339.77</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[45]</th>\n      <td>-0.59</td>\n      <td>0.38</td>\n      <td>-1.24</td>\n      <td>-0.02</td>\n      <td>0.02</td>\n      <td>0.02</td>\n      <td>620.34</td>\n      <td>294.19</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[46]</th>\n      <td>2.03</td>\n      <td>0.48</td>\n      <td>1.30</td>\n      <td>2.77</td>\n      <td>0.02</td>\n      <td>0.03</td>\n      <td>657.69</td>\n      <td>351.35</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>intercept_tank[47]</th>\n      <td>0.01</td>\n      <td>0.33</td>\n      <td>-0.52</td>\n      <td>0.54</td>\n      <td>0.01</td>\n      <td>0.01</td>\n      <td>735.81</td>\n      <td>303.89</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>sd_tank</th>\n      <td>1.61</td>\n      <td>0.20</td>\n      <td>1.28</td>\n      <td>1.92</td>\n      <td>0.01</td>\n      <td>0.01</td>\n      <td>223.71</td>\n      <td>348.72</td>\n      <td>NaN</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## R\n\n```R\nlibrary(BayesianInference)\n\n# setup platform------------------------------------------------\nm=importBI(platform='cpu')\n\n# Import data ------------------------------------------------\nm$data(m$load$reedfrogs(only_path=T), sep=';')\nm$df$tank = c(0:(nrow(m$df)-1)) # Manipulate\nm$data_to_model(list('tank', 'surv', 'density')) # Manipulate\nm$data_on_model$tank = m$data_on_model$tank$astype(jnp$int32) # Manipulate\nm$data_on_model$surv = m$data_on_model$surv$astype(jnp$int32) # Manipulate\n\n\n# Define model ------------------------------------------------\nmodel <- function(tank, surv, density){\n  # Parameter prior distributions\n  sigma = bi.dist.exponential( 1,  name = 'sigma',shape=c(1))\n  a_bar =  bi.dist.normal(0, 1.5, name='a_bar',shape=c(1))\n  alpha = bi.dist.normal(a_bar, sigma, name='alpha', shape =c(48))\n  p = alpha[tank]\n  # Likelihood\n  m$dist$binomial(total_count = density, logits = p, obs=surv)\n} \n\n# Run MCMC ------------------------------------------------\nm$fit(model) # Optimize model parameters through MCMC sampling\n\n# Summary ------------------------------------------------\nm$summary() # Get posterior distribution\n\n\n```\n\n## Julia\n```julia\nusing BayesianInference\n\n# Setup device------------------------------------------------\nm = importBI(platform=\"cpu\")\n\n# Import Data & Data Manipulation ------------------------------------------------\n# Import\ndata_path = m.load.reedfrogs(only_path = true)\nm.data(data_path, sep=';')\nm.df[\"tank\"] = jnp.arange(m.df.shape[0]) \n\n# Define model ------------------------------------------------\n@BI function model(tank, surv, density)\n    alpha = m.effects.varying_intercept(N_groups=48,group_id=tank, group_name = \"tank\")\n    m.dist.binomial(total_count = density, logits = alpha, obs=surv)\nend\n\n# Run mcmc ------------------------------------------------\nm.fit(model)  # Optimize model parameters through MCMC sampling\n\n# Summary ------------------------------------------------\nm.summary() # Get posterior distributions\n```\n:::\n\n## Mathematical Details\n\nWe model the relationship between the independent variable $X$ and the outcome variable $Y$ while accounting for varying intercepts $\\alpha$ for each group where $k(i)$ give us group belonging for observation $i$, using the following equation:\n\n\n$$\nY_{i} \\sim \\text{Normal}(\\mu_{i}, \\sigma)\n$$\n$$\n\\mu_{i} = \\alpha_{[k(i)]} + \\beta X_{i}\n$$\n\n$$\n\\beta \\sim \\text{Normal}(0, 1)\n$$\n\n$$\n\\sigma \\sim \\text{Exponential}(1)\n$$\n\n$$\n\\alpha_{[k]} \\sim \\text{Normal}(\\bar{\\alpha}, \\varsigma) \n$$\n\n$$\n\\bar{\\alpha} \\sim \\text{Normal}(0, 1)\n$$\n$$\n\\varsigma \\sim \\text{Exponential}(1)\n$$\n\nWhere:\n\n- $Y_{i}$ is the outcome variable for observation $i$.\n\n- $\\alpha_{[k(i)]}$ is the varying intercept corresponding to the group $k$ of observation $i%$.\n\n- $\\beta$ is the regression coefficient.\n\n- $\\sigma$ is a standard deviation parameter, which here has an Exponential prior that constrains it to be positive.\n\n- $\\bar{\\alpha}$ is the overall mean intercept.\n\n- $\\varsigma$ is the variance of the intercepts across groups.\n\n\n## Notes\n::: callout-note \n- We can apply multiple variables similarly to [Chapter 2](2.&#32;Multiple&#32;continuous&#32;Variables.qmd).\n\n- We can apply interaction terms similarly to [Chapter 3](/3.%20Interaction%20between%20continuous%20variables.qmd).\n\n- We can apply categorical variables similarly to [Chapter 4](/4.%20Categorical%20variable.qmd).\n\n- We can apply varying intercepts with any distribution developed in previous chapters.\n:::\n\n## Reference(s)\n::: {#refs}\n:::\n\n",
    "supporting": [
      "13. Varying intercepts_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}