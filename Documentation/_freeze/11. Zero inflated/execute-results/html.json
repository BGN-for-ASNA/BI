{
  "hash": "b83423e65baf5c5a15b125ce978d7fed",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Zero-Inflated Models\"\ndescription: \"Handling count data with an excess of zero counts by combining a count model with a logistic model.\"\ncategories: [Count Data, Regression, GLM]\nimage: \"Figures/11.png\"\norder: 14\n---\n\n## General Principles\nZero-Inflated Regression models are used when the outcome variable is a count variable with an excess of zero counts. These models combine a count model (e.g., Poisson or Negative Binomial) with a separate model for predicting the probability of excess zeros.\n\n\n## Example\n\nBelow is an example code snippet demonstrating Bayesian Zero-Inflated Poisson regression using the Bayesian Inference (BI) package. The data represent the production of books in a monastery (y), which is affected by the number of days that individuals work, as well as the number of days individuals drink. This example is based on @mcelreath2018statistical.\n\n::: {.panel-tabset group=\"language\"}\n### Python\n\n::: {#e2c3eb43 .cell execution_count=1}\n``` {.python .cell-code}\nfrom BI import bi, jnp\n\n# Setup device ------------------------------------------------\nm = bi('cpu')\n\n# Simulated data------------------------------------------------\nprob_drink = 0.2  # 20% of days\nrate_work = 1     # average 1 manuscript per day\n\n# Sample one year of production\nN = 365\ndrink = m.dist.binomial(1, prob_drink, shape = (N,), sample = True)\ny = (1 - drink) * m.dist.poisson(rate_work, shape = (N,), sample = True)\n\n# Setup device------------------------------------------------\nm.data_on_model = dict(\n    y=jnp.array(y)\n)\n\n# Define model ------------------------------------------------\ndef model(y):\n    al = m.dist.normal(1, 0.5, name='al')\n    ap = m.dist.normal(-1.5, 1, name='ap')\n    p = m.link.inv_logit(ap)\n    lambda_ = jnp.exp(al)\n    m.dist.zero_inflated_poisson(p, lambda_, obs=y)\n\n# Run MCMC ------------------------------------------------\nm.fit(model)\n\n# Summary ------------------------------------------------\nm.summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\njax.local_device_count 16\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\r  0%|          | 0/1000 [00:00<?, ?it/s]\rwarmup:   0%|          | 1/1000 [00:01<22:09,  1.33s/it, 1 steps of size 2.34e+00. acc. prob=0.00]\rwarmup:  10%|█         | 101/1000 [00:01<00:09, 97.46it/s, 31 steps of size 1.02e+00. acc. prob=0.78]\rwarmup:  20%|█▉        | 198/1000 [00:01<00:03, 203.29it/s, 7 steps of size 6.86e-01. acc. prob=0.78]\rwarmup:  29%|██▊       | 286/1000 [00:01<00:02, 303.11it/s, 1 steps of size 1.55e+00. acc. prob=0.78]\rwarmup:  39%|███▊      | 387/1000 [00:01<00:01, 425.81it/s, 3 steps of size 3.84e-01. acc. prob=0.78]\rsample:  51%|█████     | 508/1000 [00:01<00:00, 581.25it/s, 3 steps of size 6.62e-01. acc. prob=0.71]\rsample:  61%|██████    | 611/1000 [00:01<00:00, 680.27it/s, 3 steps of size 6.62e-01. acc. prob=0.85]\rsample:  73%|███████▎  | 728/1000 [00:02<00:00, 792.17it/s, 7 steps of size 6.62e-01. acc. prob=0.85]\rsample:  84%|████████▍ | 843/1000 [00:02<00:00, 882.71it/s, 5 steps of size 6.62e-01. acc. prob=0.85]\rsample:  95%|█████████▌| 951/1000 [00:02<00:00, 889.78it/s, 5 steps of size 6.62e-01. acc. prob=0.86]\rsample: 100%|██████████| 1000/1000 [00:02<00:00, 434.70it/s, 3 steps of size 6.62e-01. acc. prob=0.86]\narviz - WARNING - Shape validation failed: input_shape: (1, 500), minimum_shape: (chains=2, draws=4)\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=1}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>mean</th>\n      <th>sd</th>\n      <th>hdi_5.5%</th>\n      <th>hdi_94.5%</th>\n      <th>mcse_mean</th>\n      <th>mcse_sd</th>\n      <th>ess_bulk</th>\n      <th>ess_tail</th>\n      <th>r_hat</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>al</th>\n      <td>0.01</td>\n      <td>0.09</td>\n      <td>-0.13</td>\n      <td>0.15</td>\n      <td>0.01</td>\n      <td>0.00</td>\n      <td>139.83</td>\n      <td>196.67</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>ap</th>\n      <td>-1.28</td>\n      <td>0.36</td>\n      <td>-1.79</td>\n      <td>-0.76</td>\n      <td>0.03</td>\n      <td>0.03</td>\n      <td>163.47</td>\n      <td>208.40</td>\n      <td>NaN</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n### R\n```R\nlibrary(BayesianInference)\n\n# setup platform------------------------------------------------\nm=importBI(platform='cpu')\n\n# Simulate data ------------------------------------------------\nprob_drink = 0.2  # 20% of days\nrate_work = 1     # average 1 manuscript per day\n# sample one year of production\nN = as.integer(365)\ndrink = bi.dist.binomial(total_count = as.integer(1), probs = prob_drink, shape = c(N), sample = T ) # An example of sampling a distribution with BI\ny = (1 - drink) *  bi.dist.poisson(rate_work, shape = c(N), sample = T)\ndata = list()\ndata$y = y\nm$data_on_model = data\n\n# Define model ------------------------------------------------\nmodel <- function(y){\n  al = bi.dist.normal(1, 0.5, name='al', shape=c(1))\n  ap = bi.dist.normal(-1, 1, name='ap', shape=c(1))\n  p = m$link$inv_logit(ap)\n  lambda_ = jnp$exp(al)\n  bi.dist.zero_inflated_poisson(p, lambda_, obs=y)\n}\n\n# Run MCMC ------------------------------------------------\nm$fit(model) # Optimize model parameters through MCMC sampling\n\n# Summary ------------------------------------------------\nm$summary() # Get posterior distribution\n\n\n```\n:::\n\n# Mathematical Details\n\nWe model the relationship between the independent variable $X$ and the count outcome variable $Y$. The model assumes that the data-generating process has two states: a \"zero\" state that generates only zero counts, and a \"Poisson\" state that generates counts from a Poisson distribution.\n\nThe overall model has two main linear models ($\\pi_i$ and $\\lambda_i$):\n\n$$\nY_i \\sim \\text{ZIPoisson}(\\pi_i, \\lambda_i)\n$$\n\nWhere the mass probability mass function $\\text{ZIPoisson}(\\pi_i, \\lambda_i)$  is given by:\n\n$$\nP(Y_i | \\pi_i, \\lambda_i) = \n\\begin{cases}\n\\pi_i + (1 - \\pi_i) \\times \\text{Poisson}(0 | \\lambda_i) & \\text{if } Y_i = 0 \\\\\n(1 - \\pi_i) \\times \\text{Poisson}(Y_i | \\lambda_i) & \\text{if } Y_i > 0\n\\end{cases}\n$$\n\n1.  $\\pi_i$ A logistic regression model to predict the probability of a structural zero.\n\n2.  $\\lambda_i$ is a Poisson regression conditional on the outcome not resulting from a structural zero.\n\nJointly these two parameters allow us to estimate the probability of getting a zero ($Y_i = 0$) as the sum of two processes: the probability of a structural zero ($\\pi_i$) plus the probability of not being a structural zero ($1 - \\pi_i$) and then getting a zero from the Poisson distribution anyway.\n\nThe parameters $\\pi_i$ and $\\lambda_i$ can be modeled as functions of an independent variable $X_i$:\n\n$$\n\\text{logit}(\\pi_i) = \\alpha_\\pi + \\beta_\\pi X_i\n$$\n\n$$\n\\log(\\lambda_i) = \\alpha_ \\lambda + \\beta_\\lambda X_i\n$$\n\nWe can assign prior distributions to the model parameters with weakly informative Normal priors:\n\n$$\n\\alpha_\\pi \\sim \\text{Normal}(0, 1)\n$$\n\n$$\n\\beta_\\pi \\sim \\text{Normal}(0, 1)\n$$\n\n$$\n\\alpha_\\lambda \\sim \\text{Normal}(0, 1)\n$$\n\n$$\n\\beta_\\lambda \\sim \\text{Normal}(0, 1)\n$$\n\n\n## Reference(s)\n::: {#refs}\n:::\n\n",
    "supporting": [
      "11. Zero inflated_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}