{"title":"Beta-Binomial Model","markdown":{"headingText":"Beta-Binomial Model","containsRefs":false,"markdown":"## General Principles\nTo model the relationship between a binary outcome variable representing success counts and one or more independent variables with [<span style=\"color:#0D6EFD\">overdispersion üõà</span>]{#overdispersion}, we can use the _Beta-Binomial model_.\n\n## Considerations\n::: callout-caution \n- We have the same considerations as for [Binomial regression](5.&#32;Binomial&#32;model.qmd).\n\n- A Beta-Binomial model assumes that each binomial count observation has its own probability of success. The model estimates the distribution of probabilities of success across cases, instead of a single probability of success.\n  \n- A Beta distribution has two parameters: the rates for each probabilities and a shape parameter Œ∏. Œ∏ influence how probabilities are distributed between 0 and 1. Specifically, it consists of two parameters, $\\gamma$  and $\\eta$ , which determine the concentration of probability around 0 and 1. The values of ùõº and ùõΩ shape the distribution:\n\n  - If both are greater than 1, the distribution is bell-shaped and centered around the mean ùëù. \n\n  - If $\\gamma$ < 1 and $\\eta$ < 1, the distribution is U-shaped, indicating that outcomes are more likely to be near 0 or 1.\n\n  - If ùõº = $\\gamma$ and $\\eta$ = 1, the Beta distribution is uniform. \n\nThus, the shape parameters ùõº $\\gamma$ $\\eta$ provide flexibility in modeling various types of prior beliefs about probabilities.\n  \n:::\n\n## Example\nBelow is an example code snippet demonstrating Bayesian Beta-Binomial regression using the Bayesian Inference (BI) package. The data consist of:\n\n1) One binary dependent variable (admit), which represents candidates' admission status.\n\n2) One independent categorical variable representing individuals' gender (gid).\n\n3) Additionally, we have the number of applications (applications) per individual, which will be used to account for independent rates.\n\nThe goal is to evaluate whether the probability of admission is different between genders, while accounting for differences in the number of applications between genders.\n\n::: {.panel-tabset group=\"language\"}\n### Python\n```python\nfrom main import*#\n# Setup device------------------------------------------------\nm = bi()\n\n# Import Data & Data Manipulation ------------------------------------------------\nm.data('../data/UCBadmit.csv', sep=';') # Import\n# Data type (int, float is important, specially for indices)\nm.df[\"gid\"] = (m.df[\"applicant.gender\"] != \"male\").astype(int) # Manipulate\ngid = jnp.array(m.df[\"gid\"].astype('int32').values) # Manipulate\napplications = jnp.array(m.df[\"applications\"].astype('float32').values) # Manipulate\nadmit = jnp.array(m.df[\"admit\"].astype('float32').values) # Manipulate\n\n# Send to model (convert to jax array)\nm.data_on_model = dict(\n    gid=gid,\n    applications=applications,\n    admit=admit\n) \n\n# Define model ------------------------------------------------\ndef model(gid, applications, admit):\n    # Parameters priors distributions\n    phi = dist.exponential(1, shape=[1], name='phi')\n    alpha = dist.normal(0., 1.5, shape=[2], name='alpha')\n    t = phi + 2\n    pbar = jax.nn.sigmoid(alpha[gid])\n    gamma = pbar * t\n    eta = (1 - pbar) * t\n    # Likelihood\n    lk(\"y\", BetaBinomial(total_count=applications, concentration1=gamma, concentration0=eta), obs=admit)\n\n# Run MCMC ------------------------------------------------\nm.run(model) # Optimize model parameters through MCMC sampling\n\n# Summary ------------------------------------------------\nm.sampler.print_summary(0.89)\n```\n### R\n``` R\nlibrary(reticulate)\nbi <- import(\"main\")\n\n# Setup device------------------------------------------------\nm = bi$bi(platform='cpu')\n\n# Import Data & Data Manipulation ------------------------------------------------\nm$data('../data/UCBadmit.csv', sep=';') # Import\nm$df[\"gid\"] = as.integer(ifelse(m$df[\"applicant.gender\"] == \"male\", 0, 1)) # Manipulate\nm$data_to_model(list('gid', 'applications', 'admit' )) # Send to model (convert to jax array)\n\n# Define model ------------------------------------------------\nmodel <- function(gid, applications, admit){\n  # Parameters priors distributions\n  phi = bi$dist$exponential(1, name = 'phi')\n  alpha = bi$dist$normal(0., 1.5, shape= tuple(as.integer(2)), name='alpha')\n  t = phi + 2\n  pbar = bi$jax$nn$sigmoid(alpha[gid])\n  gamma = pbar * t\n  eta = (1 - pbar) * t\n  # Likelihood\n  bi$lk(\"y\", bi$BetaBinomial(total_count=applications, concentration1=gamma, concentration0=eta), obs=admit)\n}\n\n# Run MCMC ------------------------------------------------\nm$run(model) # Optimize model parameters through MCMC sampling\n\n# Summary ------------------------------------------------\nm$sampler$print_summary(0.89) # Get posterior distributions\n```\n\n:::\n## Mathematical Details\n### *Frequentist formulation*\n???\n\n### *Bayesian Model*\nIn the Bayesian formulation, we define each parameter with [<span style=\"color:#0D6EFD\">priors üõà</span>]{#prior}. We can express the Bayesian regression model accounting for prior distribution as follows:\n\n$$\nY_i \\sim BetaBinomial(n_i, \\gamma_i, \\eta_i)\n$$\n\n$$\n\\gamma_i = \\overline{\\rho}   \\tau \n$$\n\n$$\n\\eta_i = (1 - \\overline{\\rho} ) \\tau \n$$\n\n$$\n\\overline{\\rho} = logit(\\alpha_i)\n$$\n\n$$\n\\tau = \\phi + 2\n$$\n\n$$\n\\alpha \\sim Normal(0,1)\n$$\n\n$$\n\\phi \\sim Exponential(1)\n$$\n\nWhere:\n\n- $Y_i$ is the ount of successes for the *i*-th observation, which follows a beta-binomial distribution with $n_i$ trials.\n\n- $\\gamma_i$ represents the concentration parameter for the number of successes, derived from the probability of success and scaled by $\\tau$.\n  \n- $\\eta_i$ represents the concentration parameter for failures, derived from the probability of failure $(1 - \\overline{\\rho} )$ and also scaled by $\\tau$.\n\n- $\\overline{\\rho}$ is the probability of success for the *i*-th observation. The logit function transforms the linear predictor Œ± (which can take any real value) into a probability value between 0 and 1. \n  \n- $\\tau$ is derived from ùúô and is used as a scaling factor for the shape parameters ùõæ and ùúÇ.\n  \n- Œ± is a vector of parameters, each representing the effect of the group variable *i on the success probability.\n\n- œï is a random variable following an exponential distribution with a rate of 1.\n\n\n## Reference(s)\n@mcelreath2018statistical\n\n\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"monokai","include-after-body":["tooltip-scripts.html"],"output-file":"6. Beta binomial model.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","bibliography":["references.bib"],"theme":"Morph","backgroundcolor":"#ffffff","code-copy":true},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"6. Beta binomial model.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"block-headings":true,"bibliography":["references.bib"]},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}