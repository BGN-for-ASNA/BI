```{python}
import os
import sys
newPath = os.path.dirname(os.path.dirname(os.path.abspath("")))
if newPath not in sys.path:
    sys.path.append(newPath)

from main import *
from jax import jit
from functools import partial
import time as tm
import os
import random

```

```{python}
#| include: false
import os
from rpy2.robjects import r
r.library('STRAND')
r['load']('STRAND sim sr only.Rdata')
```


```{python}
m = bi(platform='cpu')
data = r.model_dat
data = {key: list(value) for key, value in zip(data.names, data)}

data = {key: jnp.array(value) for key, value in data.items()}
data['outcomes'] = data['outcomes'].reshape(data['N_id'][0],data['N_id'][0]).T.astype(int)
id = random.randint(1, data['N_id'][0]-1)


ids = jnp.arange(0,data['N_id'][0])
idx = m.net.vec_node_to_edgle(jnp.stack([ids, ids], axis = -1))
@jit
def logit(x):
    return jnp.log(x / (1 - x))

def model(idx, result_outcomes,focal_individual_predictors, target_individual_predictors):
    N_id = ids.shape[0]

    ## Block ---------------------------------------
    B = m.dist.normal(logit(0.1/jnp.sqrt(N_id)), 2.5, shape=(1,), name = 'block')

    #SR ---------------------------------------
    sr =  m.net.sender_receiver(focal_individual_predictors,target_individual_predictors)

    ### Dyadic--------------------------------------  
    #dr, dr_raw, dr_sigma, dr_L = m.net.dyadic_random_effects(idx.shape[0], cholesky_density = 2)# shape = n dyads
    dr = m.net.dyadic_effect(shape = idx.shape[0])
    ## SR ---------------------------------------                                                      
    m.dist.poisson(jnp.exp(B + sr + dr),  obs=result_outcomes)  

    ## NBDA -----------------------------     

m.data_on_model = dict(
    idx = idx,
    result_outcomes = m.net.mat_to_edgl(data['outcomes']), 
    focal_individual_predictors = data['individual_predictors'],
    target_individual_predictors = data['individual_predictors'],
)

m.run(model) 
summary = m.summary()
summary.loc[['focal_effects[0]', 'target_effects[0]', 'block[0]',]]
```


```{R}
r.library('BIR')
```

